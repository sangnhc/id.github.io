<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trình Chiếu Từ File Latex</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Đảm bảo MathJax được tải đúng cách từ CDN -->
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            options: {
                renderActions: {
                    addColor: [200, function (doc) {
                        for (const node of doc.math) {
                            const styles = node.typesetRoot.style;
                            styles.color = mathColor; // Sử dụng biến màu toàn cục để thay đổi màu
                        }
                    }, '']
                }
            }
        };
    </script>
    <style>
        /* CSS for the menu */
        .menu {
            display: flex;
            justify-content: center;
            background-color: #007bff;
            color: #fff;
            padding: 10px 0;
        }

        .menu a,
        .menu button {
            color: #fff;
            text-decoration: none;
            padding: 10px 20px;
            display: inline-block;
            background-color: transparent;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 16px;
            font-family: inherit;
        }

        .menu a:hover,
        .menu button:hover {
            background-color: #555;
        }

        .menu a:focus,
        .menu button:focus {
            outline: none;
            box-shadow: none;
        }

        .btn-third {
            background-color: #9c157f;
            color: #fff;
        }

        .btn-secondary {
            background-color: #09a368;
            color: #fff;
        }

        /* CSS for the render result */
        #renderResult {
            min-height: 300px;
            overflow: auto;
            background-color: #f8f9fa;
            padding: 15px;
            border: 1px solid #ddd;
        }

        /* Áp dụng font chữ */
        body {
            font-family: 'Roboto', sans-serif;
            font-size: 2em;
        }
        h1, h2, h3 {
            text-align: center;
            font-family: 'Georgia', serif;
            color: #333;
            margin-bottom: 20px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
            font-family: "Roboto", "Arial", "Helvetica", sans-serif;
    font-weight: bold;
    letter-spacing: normal; /* Giảm letter-spacing */
    text-transform: none; /* Không chuyển đổi chữ */
        }
        h1 {
            font-size: 3rem;
            color: #ff6347; /* Tomato */
            border-bottom: 4px solid #ff6347;
            display: inline-block;
            padding: 10px;
        }
        h2 {
            font-size: 2.5rem;
            color: #4682b4; /* Steel Blue */
            border-bottom: 2px solid #4682b4;
            display: inline-block;
            padding: 8px;
        }
        h3 {
            font-size: 2rem;
            color: #32cd32; /* Lime Green */
            border-bottom: 1px solid #32cd32;
            display: inline-block;
            padding: 6px;
        }
        .header {
            width: 98vw;
            padding: 50px;
            background: linear-gradient(135deg, #ffffff, #f2f2f2);
            border-radius: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            border: 2px solid #cccccc;
        }

        .header h1 {
            margin: 0;
            font-size: 4em;
            font-weight: bold;
            text-shadow: 4px 4px 6px rgba(0, 0, 0, 0.3);
            border-bottom: 6px solid #ff5e62;
            padding-bottom: 15px;
            display: inline-block;
            background: linear-gradient(135deg, #ff9966, #ff5e62);
            background-clip: text;
            color: transparent;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sub-header p {
            margin: 15px 0;
            font-size: 1.8em;
            color: #444444;
            font-style: italic;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .sub-header p:nth-child(1) {
            color: #007acc;
        }

        .sub-header p:nth-child(2) {
            color: #ff6347;
        }

        .sub-header p:nth-child(3) {
            color: #32cd32;
        }

        .footer p {
            margin-top: 30px;
            font-size: 1.5em;
            color: #555555;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            background: linear-gradient(135deg, #ff9966, #ff5e62);
            background-clip: text;
            color: transparent;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .center-img {
            display: block;
            margin-left: auto;
            margin-right: auto;
            max-width: 100%;
            height: auto;
        }

        .left-img {
            float: left;
            margin-right: 10px;
            max-width: 100%;
            height: auto;
        }

        .right-img {
            float: right;
            margin-left: 10px;
            max-width: 100%;
            height: auto;
        }

        .custom-size {
            max-width: 100%;
            height: auto;
        }

        .small-size {
            max-width: 100%;
            height: auto;
            max-height: 200px;
        }

        .tiny-size {
            max-width: 100%;
            height: auto;
            max-height: 150px;
        }

        .ngang-size {
            max-width: 100%;
            height: auto;
        }

        

        .short-ans {
            background-color: #ffebee;
            border-left: 5px solid #e53935;
            padding: 10px;
            margin: 20px 0;
            border-radius: 10px;
            position: relative;
        }

        .short-ans::before {
            content: "Điền Đáp Án: ";
            font-weight: bold;
            position: absolute;
            top: -20px;
            left: 20px;
            background-color: #e53935;
            color: white;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.9em;
        }

        .short-ans-input {
            width: 150px;
            padding: 5px;
            text-align: center;
            border: 1px solid #e53935;
            border-radius: 5px;
        }

        .custom-radio {
            display: flex;
            align-items: center;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .custom-radio input {
            display: none;
        }

        .radio-label {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #ccc;
            position: relative;
            margin-right: 10px;
            transition: background-color 0.3s ease;
            border: 2px solid #f57c00;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            color: lightblue;
            font-weight: bold;
        }

        .radio-label::before {
            content: attr(data-label);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #4CAF50;
            font-size: 24px;
            font-weight: bold;
        }

        .custom-radio input:checked~.radio-label {
            background-color: #0400f5;
        }

        .custom-radio input:checked~.radio-label::after {
            transform: translate(-50%, -50%) scale(1);
        }

        .choice-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .choice-table th,
        .choice-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }

        .small-col {
            width: 50px;
        }

        .choice-table th {
            background-color: #f57c00;
            color: white;
        }

        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }

        #scoreDialog,
        #errorDialog,
        #settingsDialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 2;
            max-width: 400px;
            width: 100%;
            font-family: 'Arial', sans-serif;
        }

        #settingsDialog input {
            width: 50px;
        }

        #timer {
            font-size: 1.5em;
            color: red;
            text-align: center;
            margin-bottom: 20px;
        }

        .toggle-solution {
            background-color: #4caf50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 10px;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: inline-block;
        }

        .toggle-solution:hover {
            background-color: #45a049;
            transform: scale(1.05);
        }

        .toggle-solution:disabled {
            background-color: #9e9e9e;
            cursor: not-allowed;
        }

        #submitBtn {
            background-color: #f44336;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2em;
            margin-top: 20px;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: inline-block;
        }

        #submitBtn:hover {
            background-color: #e53935;
            transform: scale(1.05);
        }

        #setupContainer {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            width: 95vw;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        #setupContainer label {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #007acc;
            align-self: flex-start;
        }

        #setupContainer input {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 1em;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: border 0.3s, box-shadow 0.3s;
        }

        #setupContainer input:focus {
            border-color: #007acc;
            box-shadow: inset 0 2px 6px rgba(0, 122, 204, 0.3);
            outline: none;
        }

        #setupContainer button {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: none;
            font-size: 1.2em;
            color: white;
            cursor: pointer;
            transition: background 0.3s, box-shadow 0.3s;
        }

        #generateExamBtn {
            background: linear-gradient(135deg, #ff9966, #ff5e62);
        }

        #generateExamBtn:hover {
            background: linear-gradient(135deg, #ff5e62, #ff9966);
            box-shadow: 0 5px 15px rgba(255, 94, 98, 0.4);
        }

        #settingsBtn {
            background: linear-gradient(135deg, #007acc, #00b4db);
            margin-top: 10px;
        }

        #settingsBtn:hover {
            background: linear-gradient(135deg, #00b4db, #007acc);
            box-shadow: 0 5px 15px rgba(0, 180, 219, 0.4);
        }

        #loadingMessage {
            margin-top: 20px;
            font-size: 1.2em;
            color: #ff6347;
            display: none;
        }

        #recordTable {
            margin-top: 20px;
            width: 95vw;
            max-width: 1200px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        #recordTable table {
            width: 100%;
            border-collapse: collapse;
        }

        #recordTable th,
        #recordTable td {
            padding: 10px;
            border-bottom: 1px solid #ccc;
            text-align: left;
        }

        #recordTable th {
            background-color: #007acc;
            color: white;
        }

        #recordTable td {
            background-color: #f9f9f9;
        }

        .custom-dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #f2f2f2;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 3;
            max-width: 650px;
            width: 100%;
            font-family: 'Arial', sans-serif;
            text-align: center;
        }

        .custom-dialog h3 {
            margin-bottom: 15px;
            font-size: 1.5em;
            color: #007acc;
        }

        .custom-dialog p {
            margin-bottom: 20px;
            font-size: 1.2em;
            color: #555;
        }

        .custom-dialog button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }

        .custom-dialog button:hover {
            background-color: #0056b3;
        }

        ul,
        ol {
            padding-left: 30px;
            margin-bottom: 20px;
            list-style-position: outside;
        }

        ul li,
        ol li {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #e0f7fa;
            border-left: 5px solid #00bcd4;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.3s;
        }

        ul li:hover,
        ol li:hover {
            background-color: #b2ebf2;
            transform: scale(1.05);
        }

        ol {
            counter-reset: item;
        }

        ol li {
            counter-increment: item;
        }

        ol li::before {
            content: counters(item, ".") ". ";
            font-weight: bold;
            color: #00796b;
            margin-right: 5px;
        }

        .section-title {
            text-align: center;
            background: linear-gradient(135deg, #00b4db, #32cd32);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            color: white;
            margin-bottom: 30px;
        }

        .section-title h2 {
            margin: 0;
            font-size: 2em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .section-title p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            font-style: italic;
            color: #e0ffe0;
        }

        .section-title.section-two {
            background: linear-gradient(135deg, #8e44ad, #e74c3c);
        }

        .section-title.section-three {
            background: linear-gradient(135deg, #36d1dc, #5b86e5);
        }
    </style>

  

    <!-- <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script> -->
    <style>
        /* CSS cho slide */
        .slide {
            display: none;
            /* Mặc định các slide ẩn đi */
            padding: 20px;
            text-align: center;
        }

        .active-slide {
            display: block;
            /* Slide hiện tại sẽ được hiển thị */
        }

        .navigation-buttons {
            text-align: center;
            margin-top: 10px;
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .navigation-buttons a,
        .navigation-buttons button {
            padding: 5px 10px;
            /* Kích thước nút nhỏ hơn */
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            /* Kích thước chữ nhỏ hơn */
            text-align: center;
            text-decoration: none;
            margin: 5px;
        }

        .fixed-navigation {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: #f8f9fa;
            display: flex;
            justify-content: center;
            padding: 5px;
            /* Giảm padding để chiều cao của hàng nhỏ hơn */
            border-top: 1px solid #ddd;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        }

        .fixed-navigation a,
        .fixed-navigation button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            /* Kích thước nút nhỏ hơn */
            cursor: pointer;
            border-radius: 3px;
            font-size: 12px;
            /* Kích thước chữ nhỏ hơn */
            text-align: center;
            text-decoration: none;
            margin: 5px;
        }

        .fixed-navigation button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .fixed-navigation a:hover,
        .fixed-navigation button:hover {
            background-color: #0056b3;
        }

        /* CSS cho thanh cuộn */
        body {
            margin-bottom: 80px;
            /* Chừa khoảng trống dưới cùng để không bị che bởi hàng nút */
        }

        .scrollable-content {
            max-height: calc(100vh - 100px);
            /* Chiều cao tối đa của nội dung, trừ đi khoảng trống */
            overflow-y: auto;
            /* Kích hoạt thanh cuộn dọc */
            padding-bottom: 20px;
            /* Đảm bảo không bị che bởi hàng nút */
        }

        .navigation-buttons a.btn-sm {
            font-size: 12px;
            padding: 5px 10px;
            margin: 5px;
        }

        .lythuyet {
            background-color: #e0f7fa;
            /* Màu nền tương tự như các môi trường khác */
            border-left: 5px solid #007bff;
            /* Đường viền trái màu xanh dương */
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            position: relative;
            text-align: center;
            /* Canh giữa chữ "Lý thuyết" */
        }

        .lythuyet::before {
            content: "Lý Thuyết Trọng Tâm";
            font-weight: bold;
            position: absolute;
            top: 5px;
            left: 50%;
            /* Canh giữa */
            transform: translateX(-50%);
            /* Điều chỉnh để chữ "Lý thuyết" thực sự nằm giữa */
            background-color: #007bff;
            /* Màu nền cho chữ "Lý thuyết" */
            color: white;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.9em;
        }

        .tomtat {
            background-color: #f3e5f5;
            /* Màu nền nhạt tím */
            border-left: 5px solid #8e24aa;
            /* Đường viền trái màu tím đậm */
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            position: relative;
            text-align: center;
            /* Canh giữa chữ "Tóm Tắt" */
        }

        .tomtat::before {
            content: "Tóm Tắt Nội Dung";
            font-weight: bold;
            position: absolute;
            top: 5px;
            left: 50%;
            /* Canh giữa */
            transform: translateX(-50%);
            /* Điều chỉnh để chữ "Tóm Tắt" thực sự nằm giữa */
            background-color: #8e24aa;
            /* Màu nền cho chữ "Tóm Tắt" */
            color: white;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.9em;
        }

        .kienthuctrongtam {
            background-color: #e8f5e9;
            /* Màu nền xanh nhạt */
            border-left: 5px solid #43a047;
            /* Đường viền trái màu xanh lá đậm */
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            position: relative;
            text-align: center;
            /* Canh giữa chữ "Kiến Thức Trọng Tâm" */
        }

        .kienthuctrongtam::before {
            content: "Kiến Thức Trọng Tâm";
            font-weight: bold;
            position: absolute;
            top: 5px;
            left: 50%;
            /* Canh giữa */
            transform: translateX(-50%);
            /* Điều chỉnh để chữ "Kiến Thức Trọng Tâm" thực sự nằm giữa */
            background-color: #43a047;
            /* Màu nền cho chữ "Kiến Thức Trọng Tâm" */
            color: white;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.9em;
        }
        .example {
            background-color: #fff3e0;
            border-left: 5px solid #f57c00;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            position: relative;
            text-align: left; /* Canh trái nội dung */
        }

        .example::before {
            content: "Câu " attr(data-example-number) ": ";
            font-weight: bold;
            position: absolute;
            top: -20px;
            left: 20px;
            background-color: #8300f5;
            color: white;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.9em;
        }

        .definition {
            background-color: #e0f7fa;
            border-left: 5px solid #00796b;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            position: relative;
        }

        .lemma {
            background-color: #f3e5f5;
            border-left: 5px solid #8e24aa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            position: relative;
        }

        .theorem {
            background-color: #e8f5e9;
            border-left: 5px solid #43a047;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            position: relative;
        }

        .note {
            background-color: #fffde7;
            border-left: 5px solid #ffeb3b;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            position: relative;
        }

        .caution {
            background-color: #ffebee;
            border-left: 5px solid #e53935;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            position: relative;
        }

        .definition::before {
            content: "Định nghĩa " attr(data-definition-number) ": ";
            background-color: #00796b;
            color: white;
        }

        .lemma::before {
            content: "Định lý " attr(data-lemma-number) ": ";
            background-color: #8e24aa;
            color: white;
        }

        .theorem::before {
            content: "Tính chất " attr(data-theorem-number) ": ";
            background-color: #43a047;
            color: white;
        }

        .note::before {
            content: "Ghi chú " attr(data-note-number) ": ";
            background-color: #ffeb3b;
            color: black;
        }

        .caution::before {
            content: "Lưu ý " attr(data-caution-number) ": ";
            background-color: #e53935;
            color: white;
        }

        .definition,
        .lemma,
        .theorem,
        .note,
        .vd,
        .bt,
        .caution {
            background-color: #fff3e0;
            /* Màu nền giống với .example */
            border-left: 5px solid;
            /* Đường viền trái */
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            position: relative;
            text-align: left;
            /* Canh trái nội dung văn bản */
        }

        .definition::before,
        .lemma::before,
        .theorem::before,
        .note::before,
        .vd::before,
        .bt::before,
        .caution::before {
            font-weight: bold;
            position: absolute;
            top: 5px;
            left: 20px;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.9em;
            color: white;
            /* Màu chữ trắng */
            text-align: left;
            /* Canh trái nội dung văn bản trước */
        }

        .vd {
            border-left-color: #f57c00;
            /* Màu viền trái của .vd */
        }

        .vd::before {
            content: "Ví dụ " attr(data-example-number) ": ";
            background-color: #f57c00;
            /* Nền của .vd */
        }

        .bt {
            border-left-color: #007bff;
            /* Màu viền trái của .bt */
        }

        .bt::before {
            content: "Bài tập " attr(data-exercise-number) ": ";
            background-color: #007bff;
            /* Nền của .bt */
        }



        .loigiai {
            background-color: #e0f7fa;
            border-left: 5px solid #00acc1;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            position: relative;
            display: none;
            text-align: left;
        }
        .highlight-hinh {
            color: #ffffff; /* Màu chữ trắng */
            background-color: #ff5733; /* Màu nền cam đậm */
            font-weight: bold; /* Chữ đậm */
            padding: 5px 10px; /* Thêm khoảng đệm xung quanh chữ */
            border-radius: 5px; /* Bo tròn góc */
            display: inline-block; /* Giữ inline nhưng có padding */
        } 
    </style>
</head>


<body>


    <div class="container">
        <div id="latexInputContainer">
            <h1 class="mt-4">Tạo Beamer File Latex</h1>
            <div class="form-group">
                <label for="outputCode">Load File Hoặc Dán Nội Dung File LaTex</label>
                <input type="file" id="loadTexFile" accept=".tex" class="form-control-file">
                <textarea class="form-control" id="outputCode" rows="10"></textarea>
            </div>
            <!-- Thêm khung nhập link ảnh -->
            <div class="form-group">
                <label for="linkInput">Nhập Link Ảnh Mỗi Dòng Một Link</label>
                <textarea class="form-control" id="linkInput" rows="4" placeholder="Dán các link ảnh vào đây..."></textarea>
            </div>
            <!-- Thêm nút tăng giảm kích thước chữ -->
            <div class="form-group">
                <button id="increaseFont" class="btn btn-info">Tăng Kích Thước Chữ</button>
                <button id="decreaseFont" class="btn btn-info">Giảm Kích Thước Chữ</button>
                <button id="replaceLinks" class="btn btn-success">Thay thế link ảnh</button>
            </div>
            <!-- Thêm nút đổi màu MathJax -->
            <div class="form-group">
                <label for="colorPicker">Đổi Màu Công Thức Toán:</label>
                <input type="color" id="colorPicker" class="form-control-color" value="#FF00FF">
            </div>
        </div>
    </div>
    
    <script>
        // Khởi tạo kích thước chữ mặc định
            let fontSize = 1.1; // Đơn vị là 'em'
            let mathColor = "#FF00FF"; // Màu magenta (hồng tím)

            // Hàm cập nhật kích thước chữ
            function updateFontSize() {
                document.body.style.fontSize = fontSize + 'em';
            }

            // Hàm cập nhật màu sắc cho MathJax
            function updateMathColor() {
                MathJax.typesetPromise(); // Gọi MathJax render lại để áp dụng màu mới
            }

            // Sự kiện khi nhấn nút Tăng kích thước
            document.getElementById('increaseFont').addEventListener('click', function () {
                fontSize += 0.1; // Tăng kích thước chữ
                updateFontSize(); // Cập nhật lại kích thước chữ
            });

            // Sự kiện khi nhấn nút Giảm kích thước
            document.getElementById('decreaseFont').addEventListener('click', function () {
                if (fontSize > 0.5) { // Đảm bảo kích thước không quá nhỏ
                    fontSize -= 0.1; // Giảm kích thước chữ
                    updateFontSize(); // Cập nhật lại kích thước chữ
                }
            });

            // Sự kiện khi thay đổi màu MathJax
            document.getElementById('colorPicker').addEventListener('input', function (event) {
                mathColor = event.target.value; // Lấy màu được chọn
                updateMathColor(); // Cập nhật màu sắc cho MathJax
            });

            // Áp dụng kích thước chữ ban đầu khi tải trang
            updateFontSize();
    </script>
    <script>
        function cleanExWithImmini(inputCode) {
            // Tìm tất cả các đoạn từ \begin{ex} đến \end{ex}
            return inputCode.replace(/\\begin\{ex\}([\s\S]*?)\\end\{ex\}/g, (match, content) => {
                // Kiểm tra xem đoạn đó có chứa từ khóa \immini không
                if (content.includes('\\immini')) {
                    // Thực hiện việc thay thế các ký tự thừa trong cấu trúc \begin{tikzpicture} ... \end{tikzpicture}
                    const modifiedContent = content.replace(/}\s*\{\s*(\\begin\{tikzpicture\}[\s\S]*?\\end\{tikzpicture\})\s*\}/g, '$1');
                    return `\\begin{ex}${modifiedContent}\\end{ex}`;
                }
                return match;
            });}
        function replacePlaceholdersWithLinks(inputCode) {
                // Tìm và cắt các thẻ <img ... class="center-img small-size"> trước \loigiai và di chuyển trước \choice
                inputCode = inputCode.replace(/\\begin\{ex\}([\s\S]*?)\\end\{ex\}/g, (match, content) => {
                    let modifiedContent = content;

                    // Kiểm tra xem có thẻ ảnh và \choice không
                    const imgRegex = /<span class="highlight-hinh">HINH SỐ \d+ Ở ĐÂY<\/span>/g;
                    const loigiaiIndex = content.indexOf('\\loigiai');
                    const choiceIndex = content.indexOf('\\choice');
                    let imgTags = [];

                    // Tìm và loại bỏ tất cả các thẻ <span class="highlight-hinh">HINH SỐ ...</span> trong phần \immini
                    if (choiceIndex > -1) {
                        modifiedContent = modifiedContent.replace(imgRegex, (imgTag) => {
                            // Nếu thẻ ảnh nằm trước \loigiai hoặc nằm trong phần \immini
                            if (content.indexOf(imgTag) < loigiaiIndex || loigiaiIndex === -1) {
                                imgTags.push(imgTag);
                                return ''; // Xóa thẻ ảnh khỏi vị trí cũ
                            }
                            return imgTag;
                        });

                        // Di chuyển các thẻ ảnh lên trước \choice
                        if (imgTags.length > 0) {
                            modifiedContent = modifiedContent.replace('\\choice', imgTags.join('\n') + '\n\\choice');
                        }
                    }

                    // Trả về đoạn đã sửa đổi trong \begin{ex} ... \end{ex}
                    return `\\begin{ex}${modifiedContent}\\end{ex}`;
                });
                
                return inputCode;
            }


            // Biến để lưu các khối TikZ
            let tikzBlocks = [];
            function replaceTikzEnvironment(inputCode) {
                inputCode = cleanExWithImmini(inputCode)
                inputCode = inputCode.replace(/\\immini*?\{/g, '');
                // Dùng cờ 's' để khớp với ký tự xuống dòng
                inputCode = inputCode.replace(/\\immini\s*\{/gs, '');
                inputCode = inputCode.replace(/\\immini{/g, '');
                inputCode = inputCode.replace(/\[thm\]/g, '');                
                let tikzCounter = 1;
                const tikzRegex = /\\begin{tikzpicture}[\s\S]*?\\end{tikzpicture}/g;

                // Đặt lại mảng tikzBlocks để bắt đầu lại từ đầu
                tikzBlocks = [];

                // Thay thế từng khối với HINH1, HINH2, ... và lưu trữ khối TikZ vào mảng
                inputCode = inputCode.replace(tikzRegex, (match) => {
                    // Lưu khối TikZ vào mảng tikzBlocks
                    tikzBlocks.push(`Hình ${tikzCounter}\n` + match + '\n');

                    // Thay thế bằng placeholder với chỉ số hình ảnh
                    const replacement = `<span class="highlight-hinh">HINH SỐ ${tikzCounter} Ở ĐÂY</span>`;
                    tikzCounter++;
                    return replacement;
                });

                // Truyền tikzCounter vào hàm replacePlaceholdersWithLinks
                inputCode = replacePlaceholdersWithLinks(inputCode, tikzCounter);                
                // Xóa các dòng trống, bao gồm các dòng chỉ chứa khoảng trắng
                inputCode = inputCode.replace(/^\s*[\r\n]/gm, '');
                inputCode = inputCode.replace(/<span class="highlight-hinh">HINH SỐ \d+ Ở ĐÂY<\/span>/g, match => {
                    return `<div style="text-align: center; margin: 10px 0;">${match}</div>`;
                });
                inputCode = inputCode.replace(/^\s*(\\cau|\\Closesolutionfile|\\indapan|\\Opensolutionfile).*$/gm, '');
                inputCode = inputCode.replace(/(\\shortans\{[^}]*\})(<div[^>]*>\s*<span[^>]*>HINH SỐ \d+ Ở ĐÂY<\/span><\/div>)/g, function (match, shortans, divTag) {
                    return divTag + '\n' + shortans;
                });

                return inputCode;
            }

        // Hàm đọc file và dán nội dung vào textarea
        document.getElementById('loadTexFile').addEventListener('change', function (event) {
            const file = event.target.files[0]; // Lấy file đầu tiên từ input
            if (file) {
                const reader = new FileReader();

                // Khi file được đọc xong
                reader.onload = function (e) {
                    const content = e.target.result; // Lấy nội dung file
                    const replacedContent = replaceTikzEnvironment(content); // Thay thế các khối TikZ
                    document.getElementById('outputCode').value = replacedContent; // Dán vào textarea
                    document.getElementById('outputCode').dispatchEvent(new Event('input')); // Kích hoạt render lại nội dung LaTeX

                    // Ẩn input sau khi load file
                    document.getElementById('loadTexFile').style.display = 'none';
                };

                // Đọc file dưới dạng text
                reader.readAsText(file);
            }
        });

    </script>
<script>
    // Hàm thay thế các placeholder bằng các đường dẫn ảnh từ khung linkInput
    function replacePlaceholdersWithLinksH(inputCode) {
        // Lấy nội dung từ khung linkInput và chuyển nó thành một mảng các đường dẫn
        let linkInput = document.getElementById('linkInput').value.trim();
        if (!linkInput) {
            Swal.fire({
                icon: 'warning',
                title: 'Thiếu link ảnh',
                text: 'Vui lòng nhập các đường dẫn ảnh vào khung linkInput!'
            });
            return inputCode;
        }

        // Tạo mảng chứa các đường dẫn từ linkInput
        let links = linkInput.split('\n').map(link => link.trim()).filter(link => link !== '');

        // Kiểm tra số lượng link với số lượng placeholder
        let placeholders = inputCode.match(/<span class="highlight-hinh">HINH SỐ \d+ Ở ĐÂY<\/span>/g);
        if (placeholders && links.length !== placeholders.length) {
            Swal.fire({
                icon: 'error',
                title: 'Không khớp số lượng',
                text: `Số lượng hình (${placeholders.length}) và số lượng link ảnh (${links.length}) không khớp!`
            });
            return inputCode;
        }

        // Thay thế các placeholder bằng các đường dẫn ảnh tương ứng
        inputCode = inputCode.replace(/<div style="text-align: center; margin: 10px 0;"><span class="highlight-hinh">HINH SỐ (\d+) Ở ĐÂY<\/span><\/div>/g, (match, number) => {
            const index = parseInt(number, 10) - 1;
            if (index >= 0 && index < links.length) {
                return `<img src="${links[index]}" class="center-img small-size">`;
            } else {
                return match; // Nếu không có đủ link, giữ nguyên placeholder
            }
        });

        return inputCode;
    }

    // Sự kiện khi nhấn nút "Thay thế link ảnh"
    document.getElementById('replaceLinks').addEventListener('click', function () {
        let inputCode = document.getElementById('outputCode').value;
        let replacedContent = replacePlaceholdersWithLinksH(inputCode);
        document.getElementById('outputCode').value = replacedContent;
    });
</script>

    <!-- Kết quả trình chiếu -->
    <div id="slidesContainer"></div>

    <div class="navigation-buttons fixed-navigation">
        <button id="toggleInput" class="btn btn-warning btn-sm">Ẩn Hiện</button>
        <button id="prevSlide" class="btn btn-info btn-sm">Trở Lại</button>
        <button id="nextSlide" class="btn btn-info btn-sm">Tiếp Theo</button>
        <button id="hdsdButton" class="btn btn-success btn-sm">hdsd</button> <!-- Nút HDSD -->
    </div>

    <!-- Dialog thông báo kết quả -->
    <div id="resultDialog" class="custom-dialog">
        <h3>Thông Báo</h3>
        <p id="resultMessage"></p>
        <p id="retryMessage" style="display: none;">Thử lại sau: <span id="retryCountdown">10</span> giây</p>
        <!-- <button id="closeDialogBtn">Đóng</button> -->
    </div>
    <script>
        async function speakTextWithGoogleAPI(text, gender) {
            const apiKey = 'AIzaSyB8Xtw5rP9__9g_9PXQ1tziRVF6HbQ6lKM';
            const url = `https://texttospeech.googleapis.com/v1/text:synthesize?key=${apiKey}`;

            const voiceGender = gender === 'male' ? 'MALE' : 'FEMALE';

            const requestBody = {
                input: {
                    text: text
                },
                voice: {
                    languageCode: 'en-US',
                    ssmlGender: voiceGender
                },
                audioConfig: {
                    audioEncoding: 'MP3'
                }
            };

            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                console.error('Error synthesizing speech:', response.statusText);
                return;
            }

            const data = await response.json();
            const audioContent = data.audioContent;

            // Tạo phần tử audio để phát giọng nói
            const audioElement = new Audio('data:audio/mp3;base64,' + audioContent);
            audioElement.play();
        }

        function speakText(elementId, gender) {
            const element = document.getElementById(elementId);
            if (element) {
                const text = element.textContent;
                const lang = element.getAttribute('data-lang'); // Lấy ngôn ngữ từ thuộc tính data-lang

                if (lang === 'en') {
                    // Sử dụng Google Text-to-Speech API cho tiếng Anh
                    speakTextWithGoogleAPI(text, gender);
                } else if (lang === 'vi') {
                    // Sử dụng SpeechSynthesis API cho tiếng Việt
                    const speech = new SpeechSynthesisUtterance(text);
                    const voices = speechSynthesis.getVoices();
                    const selectedVoice = voices.find(voice =>
                        voice.lang === 'vi-VN' &&
                        (gender === 'male' ? voice.name.includes('Nam') : voice.name.includes('Nữ'))
                    );

                    if (selectedVoice) {
                        speech.voice = selectedVoice;
                    }

                    speech.lang = 'vi-VN';
                    speechSynthesis.speak(speech);
                }
            }
        }

        // Đảm bảo các giọng nói đã được tải trước khi gọi
        speechSynthesis.onvoiceschanged = function () {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.disabled = false; // Kích hoạt các nút sau khi giọng đã được tải
            });
        };
    </script>
    <script type="module">
        import { wordtotex } from './wordtotex.js';
        import { word2tex } from './word2tex.js';
        import { fixCodeTool } from './fixCodeTool.js';
        import { wordtoTF } from './wordtoTF.js';
        window.wordtotex = wordtotex;
        window.word2tex = word2tex;
        window.fixCodeTool = fixCodeTool;
        window.wordtoTF = wordtoTF;
        
        function layCacNgoacLon(text) {
            let ngoacLon = [];
            let demNgoac = 0;
            let batDau = null;

            for (let i = 0; i < text.length; i++) {
                let kyTu = text[i];
                if (kyTu === "{") {
                    if (demNgoac === 0) {
                        batDau = i;
                    }
                    demNgoac += 1;
                } else if (kyTu === "}") {
                    demNgoac -= 1;
                    if (demNgoac === 0 && batDau !== null) {
                        let ketThuc = i;
                        ngoacLon.push([batDau, ketThuc]);
                        batDau = null;
                    }
                }
            }

            return ngoacLon;
        }

        function replaceBtAndVdWithEx(content) {
            content = content.replace(/{bt}/g, '{ex}');
            content = content.replace(/{vd}/g, '{ex}');
            return content;
        }

        function replaceHeva(content) {
            const regexHeva = /\\heva\s*\{/g;
            let match;
            while ((match = regexHeva.exec(content)) !== null) {
                const startIndex = match.index;
                const ngoacLon = layCacNgoacLon(content.slice(startIndex));
                if (ngoacLon.length > 0) {
                    const [batDau, ketThuc] = ngoacLon[0];
                    let innerContent = content.slice(startIndex + batDau + 1, startIndex + ketThuc);

                    innerContent = innerContent.replace(/&/g, '').replace(/>/g, '\\gt ').replace(/</g, '\\lt ').trim();

                    const fullMatch = content.slice(startIndex, startIndex + ketThuc + 1);
                    const replacedMatch = `\\begin{cases} ${innerContent} \\end{cases}`;
                    content = content.replace(fullMatch, replacedMatch);
                }
            }
            return content;
        }
        function replaceDoubleDollarWithBrackets(content) {
                // Thay thế các cặp $$...$$ thành \[...\]
                return content.replace(/\$\$(.*?)\$\$/gs, function (match, p1) {
                    return `\\[${p1}\\]`;
                });
            }
        function replaceHoac(content) {
            const regexHoac = /\\hoac\s*\{/g;
            let match;
            while ((match = regexHoac.exec(content)) !== null) {
                const startIndex = match.index;
                const ngoacLon = layCacNgoacLon(content.slice(startIndex));
                if (ngoacLon.length > 0) {
                    const [batDau, ketThuc] = ngoacLon[0];
                    let innerContent = content.slice(startIndex + batDau + 1, startIndex + ketThuc);

                    innerContent = innerContent.replace(/&/g, '').replace(/>/g, '\\gt ').replace(/</g, '\\lt ').trim();

                    const fullMatch = content.slice(startIndex, startIndex + ketThuc + 1);
                    const replacedMatch = `\\left[\\begin{array}{l} ${innerContent} \\end{array}\\right.`;
                    content = content.replace(fullMatch, replacedMatch);
                }
            }
            return content;
        }

        function replaceChoice(content) {
            const regex = /\\choice\s*\{/g;
            let match;
            while ((match = regex.exec(content)) !== null) {
                const startIndex = match.index;
                const ngoacLon = layCacNgoacLon(content.slice(startIndex));
                if (ngoacLon.length >= 4) {
                    const [batDau1, ketThuc1] = ngoacLon[0];
                    const [batDau2, ketThuc2] = ngoacLon[1];
                    const [batDau3, ketThuc3] = ngoacLon[2];
                    const [batDau4, ketThuc4] = ngoacLon[3];
                    const choices = [
                        content.slice(startIndex + batDau1 + 1, startIndex + ketThuc1),
                        content.slice(startIndex + batDau2 + 1, startIndex + ketThuc2),
                        content.slice(startIndex + batDau3 + 1, startIndex + ketThuc3),
                        content.slice(startIndex + batDau4 + 1, startIndex + ketThuc4)
                    ];
                    const labels = ['A', 'B', 'C', 'D'];
                    let transformedChoices = '<div class="choices">' + choices.map((choice, index) => {
                        const isCorrect = choice.includes('\\True');
                        choice = choice.replace('\\True', '');
                        return `<div class="choice"><input type="radio" name="choice" value="${isCorrect}"> ${labels[index]}. ${choice}</div>`;
                    }).join('') + '</div><div class="result"></div>';
                    content = content.slice(0, startIndex) + transformedChoices + content.slice(startIndex + ketThuc4 + 1);
                }
            }
            return content;
        }

        function convertNumberToMathMode(text) {
            const endExPattern = /\}\s\\end\{ex\}/g;
            text = text.replace(endExPattern, '<br>');
            text = text.replace(/\\loigiai\{/g, 'Lời giải<br>');
            text = text.replace(/\\begin\{ex\}/g, '<br>');
            return text;
        }

        function processMathContentGGG(input) {
            return input.replace(/\$([^$]+)\$/g, function (match, p1) {
                const processedContent = p1.replace(/\./g, '\\cdot ').replace(/,/g, '{,}');
                return `$${processedContent}$`;
            });
        }

        function processMathContent(input) {
            return input.replace(/\$([^$]+)\$/g, function (match, p1) {
                const processedContent = p1.replace(/(right)\.(?=\s|$)/g, '$1.')
                    .replace(/\.(?!\s*right\.)/g, '\\cdot ')
                    .replace(/,/g, '{,}')
                    .replace(/right\\cdot/g, 'right.');
                return `$${processedContent}$`;
            });
        }

        function processContent(content) {
            content = replaceBtAndVdWithEx(content);
            content = replaceHeva(content);
            content = replaceHoac(content);
            content = replaceChoice(content);
            content = convertNumberToMathMode(content);
            content = processMathContent(content);
            return content;
        }

        function convertLatexToHtmlAB(latexContent) {
            let exampleCounter = 1;
            let vdCounter = 1;
            let btCounter = 1;
            let choiceCounter = 1;
            let choiceTFCounter = 1;
            let shortAnsCounter = 1;
            let definitionCounter = 1;
            let lemmaCounter = 1;
            let theoremCounter = 1;
            let noteCounter = 1;
            let cautionCounter = 1;
            let exButtons = ""; // Biến để lưu các nút ex-i
            let vdButtons = "";
            let btButtons = "";
            let dnButtons = "";
            let dlButtons = "";
            let tcButtons = "";
            let noteButtons = "";

            let htmlContent = latexContent
                 // Chuyển \section thành h1
                .replace(/\\section{([^}]*)}/g, function (match, p1) {
                    return `<h1>${p1}</h1>`;
                })
                // Chuyển \subsection thành h2
                .replace(/\\subsection{([^}]*)}/g, function (match, p1) {
                    return `<h2>${p1}</h2>`;
                })
                // Chuyển \subsubsection thành h3
                .replace(/\\subsubsection{([^}]*)}/g, function (match, p1) {
                    return `<h3>${p1}</h3>`;
                })
                .replace(/\\begin{ex}/g, function () {
                    exButtons += `<a href="#ex-${exampleCounter}" class="btn btn-primary btn-sm">ex${exampleCounter}</a>`; // Thêm nút ex-i
                    return `<div id="ex-${exampleCounter}" class="example slide" data-example-number="${exampleCounter++}"> `;
                })
                .replace(/\\end{ex}/g, '</div>')
                .replace(/\\begin{vd}/g, function () {
                    vdButtons += `<a href="#vd-${vdCounter}" class="btn btn-success btn-sm">vd${vdCounter}</a>`; // Thêm nút vd-i
                    return `<div id="vd-${vdCounter}" class="vd slide" data-example-number="${vdCounter++}"><br>`;
                })
                .replace(/\\end{vd}/g, '</div>')
                .replace(/\\begin{bt}/g, function () {
                    btButtons += `<a href="#bt-${btCounter}" class="btn btn-warning btn-sm">bt${btCounter}</a>`; // Thêm nút bt-i
                    return `<div id="bt-${btCounter}" class="bt slide" data-exercise-number="${btCounter++}"><br>`;
                })
                .replace(/\\end{bt}/g, '</div>')
                .replace(/\\begin{dn}/g, function () {
                    dnButtons += `<a href="#dn-${definitionCounter}" class="btn btn-danger btn-sm">dn${definitionCounter}</a>`; // Thêm nút dn-i
                    return `<div id="dn-${definitionCounter}" class="definition slide" data-definition-number="${definitionCounter++}"><br>`;
                })
                .replace(/\\end{dn}/g, '</div>')
                .replace(/\\begin{dl}/g, function () {
                    dlButtons += `<a href="#dl-${lemmaCounter}" class="btn btn-info btn-sm">dl${lemmaCounter}</a>`; // Thêm nút dl-i
                    return `<div id="dl-${lemmaCounter}" class="lemma slide" data-lemma-number="${lemmaCounter++}"><br>`;
                })
                .replace(/\\end{dl}/g, '</div>')
                .replace(/\\begin{tc}/g, function () {
                    tcButtons += `<a href="#tc-${theoremCounter}" class="btn btn-dark btn-sm">tc${theoremCounter}</a>`; // Thêm nút tc-i
                    return `<div id="tc-${theoremCounter}" class="theorem slide" data-theorem-number="${theoremCounter++}"><br>`;
                })
                .replace(/\\end{tc}/g, '</div>')
                .replace(/\\begin{note}/g, function () {
                    noteButtons += `<a href="#note-${noteCounter}" class="btn btn-secondary btn-sm">note${noteCounter}</a>`; // Thêm nút note-i
                    return `<div id="note-${noteCounter}" class="note slide" data-note-number="${noteCounter++}"><br>`;
                })
                .replace(/\\end{note}/g, '</div>')
                .replace(/\\begin{luuy}/g, function () {
                    return `<div class="caution slide" data-caution-number="${cautionCounter++}"><br>`;
                })
                .replace(/\\end{luuy}/g, '</div>')
                .replace(/\\begin{lythuyet}/g, function () {
                    return `<div class="lythuyet slide"><br>`;
                })
                .replace(/\\end{lythuyet}/g, '</div>')
                .replace(/\\begin{tomtat}/g, function () {
                    return `<div class="tomtat slide"><br>`;
                })
                .replace(/\\end{tomtat}/g, '</div>')
                .replace(/\\begin{kienthuctrongtam}/g, function () {
                    return `<div class="kienthuctrongtam slide"><br>`;
                })
                .replace(/\\end{kienthuctrongtam}/g, '</div>')
                .replace(/dropbox.com/g, 'dl.dropboxusercontent.com')
                .replace(/&dl=0/g, '');
            htmlContent = htmlContent.replace(/\\choiceTF[^{]*\{/g, '\\choiceTF{')
                .replace(/\\vec/g, '\\overrightarrow')
                .replace(/\\vv/g, '\\overrightarrow')
                .replace(/\\itemchoice/g, '\\itemsize')
                .replace(/\\itemch/g, '\\item');
            htmlContent = replaceDoubleDollarWithBrackets(htmlContent)
            htmlContent = replaceChoiceAB(htmlContent, choiceCounter++);
            htmlContent = replaceChoiceABTF(htmlContent, choiceTFCounter++);
            htmlContent = replaceShortAnsAB(htmlContent, shortAnsCounter++);
            htmlContent = replaceLoigiaiAB(htmlContent, exampleCounter++);
            htmlContent = replaceBreaksInLaTeX(htmlContent);
            htmlContent = replaceHevaAB(htmlContent);
            htmlContent = replaceHoacAB(htmlContent);
            htmlContent = removeLatexCommentsAB(htmlContent);
            
            htmlContent = htmlContent.replace(/\\begin{itemize}/g, '<ul>')
                .replace(/\\end{itemize}/g, '</ul>')
                .replace(/\\item\s+/g, '<li>');

            htmlContent = htmlContent.replace(/\\begin{enumerate}/g, '<ol>')
                .replace(/\\end{enumerate}/g, '</ol>')
                .replace(/\\item\s+/g, '<li>');

            htmlContent = htmlContent.replace(/\\begin{center}/g, '<div style="text-align: center;">')
                .replace(/\\end{center}/g, '</div>');

            htmlContent = htmlContent.replace(/\\loigiai/g, '')
                .replace(/\\choiceTF/g, '')
                .replace(/\\choice/g, '')
                .replace(/\\shortans/g, '');
            return {
                content: htmlContent,
                buttons: exButtons + vdButtons + btButtons + dnButtons + dlButtons + tcButtons + noteButtons // Gộp tất cả các nút
            };
        }

        function replaceChoiceABTF_DaOK(content, questionIndex) {
            const regex = /\\choiceTF\s*\{/g;

            let result = '';
            let lastIndex = 0;
            let localCounter = 1;

            content.replace(regex, (match, offset, string) => {
                let startIndex = offset + match.length - 1;
                let remainingString = string.slice(startIndex);
                let braces = layCacNgoacLon(remainingString);

                if (braces.length >= 4) {
                    let choices = braces.slice(0, 4).map(pair => remainingString.slice(pair[0] + 1, pair[1]));
                    let transformedChoices = '<table class="choice-table"><thead><tr><th>Phương án</th><th class="small-col">Đúng</th><th class="small-col">Sai</th></tr></thead><tbody>'
                        + choices.map((choice, index) => {
                            const isCorrect = choice.includes('\\True');
                            choice = choice.replace('\\True', '');
                            return `<tr>
                          <td>${choice}</td>
                          <td class="small-col">
                              <label class="custom-radio">
                                  <input type="radio" name="choiceTF-${questionIndex}-${localCounter}-${index}" value="true" data-correct="${isCorrect}">
                                  <span class="radio-label"></span>
                              </label>
                          </td>
                          <td class="small-col">
                              <label class="custom-radio">
                                  <input type="radio" name="choiceTF-${questionIndex}-${localCounter}-${index}" value="false" data-correct="${!isCorrect}">
                                  <span class="radio-label"></span>
                              </label>
                          </td>
                      </tr>`;
                        }).join('') + '</tbody></table>';

                    result += content.slice(lastIndex, startIndex) + transformedChoices;
                    lastIndex = startIndex + braces[3][1] + 1;
                    localCounter++;
                }
                return match;
            });

            result += content.slice(lastIndex);
            return result;
        }
        function replaceChoiceABTF(content, questionIndex) {
                const regex = /\\choiceTF\s*\{/g;

                let result = '';
                let lastIndex = 0;
                let localCounter = 1;

                content.replace(regex, (match, offset, string) => {
                    let startIndex = offset + match.length - 1;
                    let remainingString = string.slice(startIndex);
                    let braces = layCacNgoacLon(remainingString);

                    if (braces.length >= 4) {
                        let choices = braces.slice(0, 4).map(pair => remainingString.slice(pair[0] + 1, pair[1]));

                        // Tạo bảng với các phương án đúng/sai
                        let transformedChoices = '<table class="choice-table"><thead><tr><th>Phương án</th><th class="small-col">Đúng</th><th class="small-col">Sai</th></tr></thead><tbody>'
                            + choices.map((choice, index) => {
                                const hasTrue = choice.includes('\\True'); // Kiểm tra có '\\True'
                                choice = choice.replace('\\True', '').trim(); // Xóa '\\True'

                                // Nếu có '\\True' thì cột 'Đúng' đúng và cột 'Sai' sai
                                // Nếu không có '\\True' thì cột 'Đúng' sai và cột 'Sai' đúng
                                const correctForTrue = hasTrue ? 'true' : 'false';
                                const correctForFalse = hasTrue ? 'false' : 'true';

                                return `<tr>
                      <td>${choice}</td>
                      <td class="small-col">
                          <label class="custom-radio">
                              <input type="radio" name="choiceTF-${questionIndex}-${localCounter}-${index}" value="true" data-correct="${correctForTrue}">
                              <span class="radio-label"></span>
                          </label>
                      </td>
                      <td class="small-col">
                          <label class="custom-radio">
                              <input type="radio" name="choiceTF-${questionIndex}-${localCounter}-${index}" value="false" data-correct="${correctForFalse}">
                              <span class="radio-label"></span>
                          </label>
                      </td>
                  </tr>`;
                            }).join('') + '</tbody></table>';

                        result += content.slice(lastIndex, startIndex) + transformedChoices;
                        lastIndex = startIndex + braces[3][1] + 1;
                        localCounter++;
                    }
                    return match;
                });

                result += content.slice(lastIndex);
                return result;
            }

        function replaceChoiceAB(content, questionIndex) {
            const regex = /\\choice\s*\{/g;

            let result = '';
            let lastIndex = 0;
            let localCounter = 1;
            const choiceLabels = ['A', 'B', 'C', 'D'];

            content.replace(regex, (match, offset, string) => {
                let startIndex = offset + match.length - 1;
                let remainingString = string.slice(startIndex);
                let braces = layCacNgoacLon(remainingString);

                if (braces.length >= 4) {
                    let choices = braces.slice(0, 4).map((pair, index) => remainingString.slice(pair[0] + 1, pair[1]));
                    let transformedChoices = '<div class="choice-container">' +
                        choices.map((choice, index) => {
                            const isCorrect = choice.includes('\\True');
                            choice = choice.replace('\\True', '');
                            return `<div class="choice">
                <label class="custom-radio">
                    <input type="radio" name="choice-${questionIndex}-${localCounter}" value="${isCorrect}">
                    <span class="radio-label" data-label="${choiceLabels[index]}"></span>
                    ${choice}
                </label>
              </div>`;
                        }).join('') + '</div>';

                    result += content.slice(lastIndex, startIndex) + transformedChoices;
                    lastIndex = startIndex + braces[3][1] + 1;
                    localCounter++;
                }
                return match;
            });

            result += content.slice(lastIndex);
            return result;
        }

        function replaceShortAnsAB(content, questionIndex) {
            const regex = /\\shortans\s*\{/g;
            let result = '';
            let lastIndex = 0;
            let localCounter = 1;

            content.replace(regex, (match, offset, string) => {
                let startIndex = offset + match.length - 1;
                let remainingString = string.slice(startIndex);
                let braces = layCacNgoacLon(remainingString);

                if (braces.length > 0) {
                    let answerContent = remainingString.slice(braces[0][0] + 1, braces[0][1]);
                    let cleanedAnswer = answerContent.replace(/[\${}]/g, '').replace(/,/g, '.');
                    result += content.slice(lastIndex, startIndex) + `<div class="short-ans"><input type="text" class="short-ans-input" maxlength="10" data-correct-answer="${cleanedAnswer}" name="shortans-${questionIndex}-${localCounter}"></div>`;
                    lastIndex = startIndex + braces[0][1] + 1;
                    localCounter++;
                }
                return match;
            });

            result += content.slice(lastIndex);
            return result;
        }

        function replaceLoigiaiAB(content, questionIndex) {
            const regex = /\\loigiai\s*\{/g;

            let result = '';
            let lastIndex = 0;

            content.replace(regex, (match, offset, string) => {
                let startIndex = offset + match.length - 1;
                let remainingString = string.slice(startIndex);
                let braces = layCacNgoacLon(remainingString);

                if (braces.length > 0) {
                    let loigiaiContent = remainingString.slice(braces[0][0] + 1, braces[0][1]);

                    result += content.slice(lastIndex, startIndex) + `
                <div class="loigiai" id="loigiai-${questionIndex}">${loigiaiContent}</div>
                <br>
                <button class="toggle-solution" data-solution="loigiai-${questionIndex}">Ẩn lời giải</button>`;

                    lastIndex = startIndex + braces[0][1] + 1;
                    questionIndex++;
                }
                return match;
            });

            result += content.slice(lastIndex);
            return result;
        }
        document.addEventListener('click', function (event) {
                // Xử lý sự kiện toggle lời giải
                if (event.target.classList.contains('toggle-solution')) {
                    const solutionId = event.target.getAttribute('data-solution');
                    const solutionElement = document.getElementById(solutionId);

                    if (solutionElement) {
                        if (solutionElement.style.display === 'none') {
                            solutionElement.style.display = 'block';
                            event.target.textContent = 'Ẩn lời giải';
                        } else {
                            solutionElement.style.display = 'none';
                            event.target.textContent = 'Xem lời giải';
                        }
                    }
                }

                // Xử lý sự kiện khi chọn đáp án
                if (event.target.type === 'radio') {
                    // Phân biệt câu hỏi theo loại (choiceTF hoặc choice)
                    const nameAttribute = event.target.name;

                    // Trường hợp cho câu hỏi loại choiceTF
                    if (nameAttribute.startsWith('choiceTF')) {
                        // Kiểm tra giá trị của thuộc tính data-correct
                        const isCorrect = event.target.getAttribute('data-correct') === "true";
                        handleResult(isCorrect);
                    }

                    // Trường hợp cho câu hỏi loại choice
                    else if (nameAttribute.startsWith('choice')) {
                        // Dùng giá trị gốc của radio để xác định đúng/sai
                        const isCorrect = event.target.value === "true";
                        handleResult(isCorrect);
                    }
                }
            });

            // Hàm xử lý kết quả hiển thị
            function handleResult(isCorrect) {
                const dialog = document.getElementById('resultDialog');
                const resultMessage = document.getElementById('resultMessage');
                const retryMessage = document.getElementById('retryMessage');
                const retryCountdown = document.getElementById('retryCountdown');

                if (isCorrect) {
                    resultMessage.textContent = "Đáp án chính xác!";
                    retryMessage.style.display = 'none';
                    dialog.style.display = 'block';
                    setTimeout(() => {
                        dialog.style.display = 'none'; // Tự động đóng dialog sau vài giây
                    }, 2000);
                } else {
                    resultMessage.textContent = "Sai rồi, thử lại sau 10 giây.";
                    retryMessage.style.display = 'block';

                    let countdown = 10;
                    retryCountdown.textContent = countdown;

                    const countdownInterval = setInterval(() => {
                        countdown--;
                        retryCountdown.textContent = countdown;
                        if (countdown === 0) {
                            clearInterval(countdownInterval);
                            dialog.style.display = 'none'; // Tự động đóng dialog sau 10 giây
                        }
                    }, 1000);

                    event.target.disabled = true;
                    setTimeout(() => {
                        event.target.disabled = false;
                    }, 10000);
                }

                dialog.style.display = 'block';
            }

        // document.addEventListener('click', function (event) {
        //     // Xử lý sự kiện toggle lời giải
        //     if (event.target.classList.contains('toggle-solution')) {
        //         const solutionId = event.target.getAttribute('data-solution');
        //         const solutionElement = document.getElementById(solutionId);

        //         if (solutionElement) {
        //             if (solutionElement.style.display === 'none') {
        //                 solutionElement.style.display = 'block';
        //                 event.target.textContent = 'Ẩn lời giải';
        //             } else {
        //                 solutionElement.style.display = 'none';
        //                 event.target.textContent = 'Xem lời giải';
        //             }
        //         }
        //     }

        //     // Xử lý sự kiện khi chọn đáp án
        //     if (event.target.type === 'radio' && event.target.name.startsWith('choice')) {
        //         const isCorrect = event.target.value === "true";
        //         const dialog = document.getElementById('resultDialog');
        //         const resultMessage = document.getElementById('resultMessage');
        //         const retryMessage = document.getElementById('retryMessage');
        //         const retryCountdown = document.getElementById('retryCountdown');

        //         if (isCorrect) {
        //             resultMessage.textContent = "Đáp án chính xác!";
        //             retryMessage.style.display = 'none';
        //             dialog.style.display = 'block';
        //             setTimeout(() => {
        //                 dialog.style.display = 'none'; // Tự động đóng dialog sau vài giây
        //             }, 2000);
        //         } else {
        //             resultMessage.textContent = "Sai rồi, thử lại sau 10 giây.";
        //             retryMessage.style.display = 'block';

        //             let countdown = 10;
        //             retryCountdown.textContent = countdown;

        //             const countdownInterval = setInterval(() => {
        //                 countdown--;
        //                 retryCountdown.textContent = countdown;
        //                 if (countdown === 0) {
        //                     clearInterval(countdownInterval);
        //                     dialog.style.display = 'none'; // Tự động đóng dialog sau 10 giây
        //                 }
        //             }, 1000);

        //             event.target.disabled = true;
        //             setTimeout(() => {
        //                 event.target.disabled = false;
        //             }, 10000);
        //         }

        //         dialog.style.display = 'block';
        //     }
        // });



        function replaceBreaksInLaTeX(input) {
            const mathEnvironments = [
                /\$\$.*?\$\$/gs,
                /\$.*?\$/g,
                /\\\(.+?\\\)/gs,
                /\\\[.+?\\\]/gs,
                /\\begin{equation}.*?\\end{equation}/gs,
                /\\begin{align}.*?\\end{align}/gs,
                /\\begin{math}.*?\\end{math}/gs,
                /\\begin{displaymath}.*?\\end{displaymath}/gs,
                /\\begin{tabular}.*?\\end{tabular}/gs,
                /\\begin{array}.*?\\end{array}/gs,
                /\\begin{matrix}.*?\\end{matrix}/gs,
                /\\begin{eqnarray\*?}.*?\\end{eqnarray\*?}/gs,
                /\\begin{aligned}.*?\\end{aligned}/gs
            ];

            let matches = [];
            mathEnvironments.forEach((regex) => {
                let match;
                while ((match = regex.exec(input)) !== null) {
                    let modifiedMatch = match[0].replace(/>/g, ' > ').replace(/</g, ' < ');
                    matches.push(modifiedMatch);
                    input = input.replace(match[0], `__PLACEHOLDER_${matches.length - 1}__`);
                }
            });

            let output = input.replace(/\\\\/g, '<br>');

            matches.forEach((original, index) => {
                output = output.replace(`__PLACEHOLDER_${index}__`, original);
            });

            return output;
        }

        function replaceHevaAB(content) {
            const regexHeva = /\\heva\s*\{/g;
            let match;
            while ((match = regexHeva.exec(content)) !== null) {
                const startIndex = match.index;
                const ngoacLon = layCacNgoacLon(content.slice(startIndex));
                if (ngoacLon.length > 0) {
                    const [batDau, ketThuc] = ngoacLon[0];
                    let innerContent = content.slice(startIndex + batDau + 1, startIndex + ketThuc);

                    innerContent = innerContent.replace(/&/g, '').replace(/>/g, '\\gt ').replace(/</g, '\\lt ').trim();

                    const fullMatch = content.slice(startIndex, startIndex + ketThuc + 1);
                    const replacedMatch = `\\begin{cases} ${innerContent} \\end{cases}`;
                    content = content.replace(fullMatch, replacedMatch);
                }
            }
            return content;
        }

        function replaceHoacAB(content) {
            const regexHoac = /\\hoac\s*\{/g;
            let match;
            while ((match = regexHoac.exec(content)) !== null) {
                const startIndex = match.index;
                const ngoacLon = layCacNgoacLon(content.slice(startIndex));
                if (ngoacLon.length > 0) {
                    const [batDau, ketThuc] = ngoacLon[0];
                    let innerContent = content.slice(startIndex + batDau + 1, startIndex + ketThuc);

                    innerContent = innerContent.replace(/&/g, '').replace(/>/g, '\\gt ').replace(/</g, '\\lt ').trim();

                    const fullMatch = content.slice(startIndex, startIndex + ketThuc + 1);
                    const replacedMatch = `\\left[\\begin{array}{l} ${innerContent} \\end{array}\\right.`;
                    content = content.replace(fullMatch, replacedMatch);
                }
            }
            return content;
        }

        function removeLatexCommentsAB(content) {
            content = content.replace(/{listEX}/g, '{enumerate}');
            content = content.replace(/{aligned}\[t\]/g, '{aligned}');
            content = content.replace(/\\quad|\\qquad/g, ' ');
            content = content.replace(/\\newline/g, '<br>');
            content = content.replace(/\\lq\\lq/g, '"');
            content = content.replace(/\\rq\\rq/g, '"');
            content = content.replace(/\\textbf\{(.*?)\}/g, '<strong>$1</strong>');
            content = content.replace(/\\bf\{(.*?)\}/g, '<strong>$1</strong>');
            content = content.replace(/\\textit\{(.*?)\}/g, '<em>$1</em>');
            content = content.replace(/\\textbf\{\\textit\{(.*?)\}\}/g, '<strong><em>$1</em></strong>');
            content = content.replace(/\\textit\{\\textbf\{(.*?)\}\}/g, '<em><strong>$1</strong></em>');
            content = content.replace(/(^|[^\\])%.*/gm, '$1');
            
            return content;
        }

        // Hàm render MathJax và cập nhật màu
            function renderMath() {
                let content = document.getElementById('outputCode').value;           
                let processed = convertLatexToHtmlAB(content); // Xử lý nội dung LaTeX

                // Xóa các nút trước khi thêm mới
                const navigationButtons = document.querySelector('.navigation-buttons.fixed-navigation');
                navigationButtons.querySelectorAll('a[href^="#ex-"], a[href^="#vd-"], a[href^="#bt-"], a[href^="#dn-"], a[href^="#dl-"], a[href^="#tc-"], a[href^="#note-"]').forEach(node => node.remove());

                // Chèn nội dung vào slidesContainer
                const slidesContainer = document.getElementById('slidesContainer');
                slidesContainer.innerHTML = processed.content;

                // Chèn các nút vào navigation-buttons
                const buttonsFragment = document.createElement('div');
                buttonsFragment.innerHTML = processed.buttons;
                navigationButtons.insertBefore(buttonsFragment, navigationButtons.firstChild);

                const slides = document.querySelectorAll('.slide');

                // Kiểm tra và hiển thị slide đầu tiên
                if (slides.length > 0) {
                    slides[0].classList.add('active-slide');
                } else {
                    console.error("No slides found.");
                    return; // Thoát nếu không có slide nào để hiển thị
                }

                MathJax.typesetPromise([slidesContainer]).then(() => {
                    let currentSlideIndex = 0;

                    function showSlide(index) {
                        if (slides[currentSlideIndex]) {
                            slides[currentSlideIndex].classList.remove('active-slide');
                        }

                        if (index >= 0 && index < slides.length) {
                            currentSlideIndex = index;
                            slides[currentSlideIndex].classList.add('active-slide');
                        }

                        document.getElementById('nextSlide').disabled = currentSlideIndex === slides.length - 1;
                        document.getElementById('prevSlide').disabled = currentSlideIndex === 0;
                    }

                    // Lấy slide từ hash
                    function getSlideIndexFromHash() {
                        const hash = window.location.hash;
                        if (hash) {
                            const id = hash.substring(1); // Lấy phần sau dấu #
                            const targetSlide = document.getElementById(id);
                            if (targetSlide) {
                                return Array.from(slides).indexOf(targetSlide);
                            }
                        }
                        return -1;
                    }

                    // Xử lý sự kiện hashchange
                    window.addEventListener('hashchange', () => {
                        const slideIndex = getSlideIndexFromHash();
                        if (slideIndex !== -1) {
                            showSlide(slideIndex);
                        }
                    });

                    // Kiểm tra hash ban đầu khi tải trang
                    const initialSlideIndex = getSlideIndexFromHash();
                    if (initialSlideIndex !== -1) {
                        showSlide(initialSlideIndex);
                    } else if (slides.length > 0) {
                        slides[0].classList.add('active-slide'); // Hiển thị slide đầu tiên nếu không có hash
                    }

                    document.getElementById('nextSlide').addEventListener('click', () => {
                        if (currentSlideIndex < slides.length - 1) {
                            showSlide(currentSlideIndex + 1);
                            window.location.hash = slides[currentSlideIndex].id; // Cập nhật hash
                        }
                    });

                    document.getElementById('prevSlide').addEventListener('click', () => {
                        if (currentSlideIndex > 0) {
                            showSlide(currentSlideIndex - 1);
                            window.location.hash = slides[currentSlideIndex].id; // Cập nhật hash
                        }
                    });

                    // Disable/Enable buttons based on initial slide index
                    document.getElementById('nextSlide').disabled = currentSlideIndex === slides.length - 1;
                    document.getElementById('prevSlide').disabled = currentSlideIndex === 0;
                }).catch((err) => console.error("MathJax typeset error: ", err));
            }

            // Gọi hàm renderMath khi input thay đổi
            document.getElementById('outputCode').addEventListener('input', renderMath);
            document.getElementById('outputCode').dispatchEvent(new Event('input'));

        // Toggle visibility of the LaTeX input section
        document.getElementById('toggleInput').addEventListener('click', function () {
            const inputContainer = document.getElementById('latexInputContainer');
            const toggleButton = document.getElementById('toggleInput');

            if (inputContainer.style.display === 'none' || inputContainer.style.display === '') {
                inputContainer.style.display = 'block';
                toggleButton.textContent = 'Ẩn';
            } else {
                inputContainer.style.display = 'none';
                toggleButton.textContent = 'Hiện';
            }
        });
        document.getElementById('hdsdButton').addEventListener('click', function () {
                window.open('hdsd.html', '_blank');
            });
     </script>
     
</body>

</html>
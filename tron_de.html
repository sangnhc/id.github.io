<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hoán vị file LaTeX</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #f1f1f1;
            --hover-color: #45a049;
            --button-color: #4CAF50;
            --text-color: white;
            --button-text-color: yellow;
        }

        body {
            background-color: var(--secondary-color);
            font-family: Arial, sans-serif;
        }

        .container {
            margin-top: 20px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .menu {
            width: 100%;
            background-color: var(--primary-color);
            overflow: hidden;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .menu a {
            float: left;
            display: block;
            color: var(--text-color);
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        .menu a:hover {
            background-color: var(--hover-color);
            color: var(--text-color);
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
        }

        .nav-tabs .nav-item.show .nav-link, .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background-color: var(--secondary-color);
            border-color: var(--primary-color) var(--primary-color) var(--secondary-color);
        }

        .nav-tabs .nav-link {
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            transition: background-color 0.3s;
        }

        .nav-tabs .nav-link:hover {
            background-color: var(--hover-color);
            color: var(--text-color);
        }

        .form-group label {
            font-weight: bold;
        }

        .btn-primary, .btn-success, .btn-secondary {
            background-color: var(--button-color);
            border: none;
            color: var(--button-text-color);
            width: 22%;
            margin-right: 10px;
        }

        .btn-primary:hover, .btn-success:hover, .btn-secondary:hover {
            background-color: var(--hover-color);
            color: var(--text-color);
        }

        .btn:last-child {
            margin-right: 0;
        }

        .d-flex {
            justify-content: center !important;
        }
    </style>
</head>

<body>
    <div class="menu">
        <a href="index.html">Quay Về Trang Chủ</a>
    </div>
    <div class="container">
        <h1>Trộn Đề Cấu Trúc 2025</h1>
        <ul class="nav nav-tabs d-flex justify-content-center" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="upload-tab" data-toggle="tab" href="#upload" role="tab" aria-controls="upload" aria-selected="true">Tải lên file</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="paste-tab" data-toggle="tab" href="#paste" role="tab" aria-controls="paste" aria-selected="false">Dán nội dung</a>
            </li>
        </ul>
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="upload" role="tabpanel" aria-labelledby="upload-tab">
                <form id="uploadForm" method="post" enctype="multipart/form-data" class="mt-3">
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="school">Tên Trường:</label>
                            <input type="text" class="form-control" id="school" required>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="teacher">Tên Giáo Viên:</label>
                            <input type="text" class="form-control" id="teacher" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="exam">Tên Kỳ Thi:</label>
                            <input type="text" class="form-control" id="exam" required>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="subject">Tên Môn Thi:</label>
                            <input type="text" class="form-control" id="subject" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="time">Thời Gian Làm Bài (phút):</label>
                            <input type="number" class="form-control" id="time" required>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="made">Mã Đề Thi:</label>
                            <input type="text" class="form-control" id="made" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="uploadFile">Chọn file LaTeX:</label>
                            <input type="file" class="form-control" id="uploadFile" name="file" required>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="numFiles">Số lượng file hoán vị:</label>
                            <input type="number" class="form-control" id="numFiles" name="num_files" min="1" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="hoanViType">Loại hoán vị:</label>
                            <select class="form-control" id="hoanViType" name="hoan_vi_type">                                
                                <option value="cau_truc">Trộn Đề Theo Mức Độ</option>
                                <option value="ngoac">Trộn Các Phương Án</option>
                                <option value="giu_nguyen">Giữ Nguyên Đề</option>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="headerType">Tuỳ chọn main:</label>
                            <select class="form-control" id="headerType" name="header_type">
                                <option value="default">Mặc định</option>
                                <option value="option1">Option 1</option>
                                <option value="option2">Option 2</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="phieuTo">Phiếu Tô:</label>
                            <select class="form-control" id="phieuTo" name="phieu_to">
                                <option value="phieu0">Mặc Định</option>
                                <option value="phieu1">Phiếu TN Maker</option>
                                <option value="phieu2">Phiếu Chấm Thi</option>
                                <option value="phieu3">Phiếu Azota V1.5</option>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="dapAn">Đáp Án:</label>
                            <select class="form-control" id="dapAn" name="dap_an">
                                <option value="dap_an_1">Đáp án loại 1</option>
                                <option value="dap_an_2">Đáp án loại 2</option>
                                <option value="dap_an_3">Đáp án loại 3</option>
                            </select>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between mt-4">
                        <button type="submit" class="btn btn-primary">Tải file lên</button>
                        <button id="permuteButton" class="btn btn-success">Trộn Đề </button>
                        <button id="downloadXlsxButton" class="btn btn-secondary">Trộn Đề + TN Maker</button>
                        <button id="downloadXlsxButtonTwo" class="btn btn-secondary">Trộn Đề + Chấm Thi</button>
                    </div>
                </form>
            </div>
            <div class="tab-pane fade" id="paste" role="tabpanel" aria-labelledby="paste-tab">
                <form id="pasteForm" class="mt-3">
                    <div class="form-group">
                        <label for="pasteContent">Dán nội dung LaTeX:</label>
                        <textarea class="form-control" id="pasteContent" name="content" rows="10" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-4">
                            <label for="numPasteFiles">Số lượng file hoán vị:</label>
                            <input type="number" class="form-control" id="numPasteFiles" name="num_files" min="1" required>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="hoanViTypePaste">Loại hoán vị:</label>
                            <select class="form-control" id="hoanViTypePaste" name="hoan_vi_type">
                                <option value="ngoac">Hoán vị các cặp ngoặc</option>
                                <option value="cau_truc">Hoán vị các cặp ngoặc và cấu trúc</option>
                                <option value="giu_nguyen">Giữ nguyên</option>
                            </select>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="headerTypePaste">Loại khai báo đầu file:</label>
                            <select class="form-control" id="headerTypePaste" name="header_type">
                                <option value="default">Default</option>
                                <option value="option1">Option 1</option>
                                <option value="option2">Option 2</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="phieuToPaste">Phiếu Tô:</label>
                            <select class="form-control" id="phieuToPaste" name="phieu_to">
                                <option value="phieu1">Phiếu 1</option>
                                <option value="phieu2">Phiếu 2</option>
                                <option value="phieu3">Phiếu 3</option>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="dapAnPaste">Đáp Án:</label>
                            <select class="form-control" id="dapAnPaste" name="dap_an">
                                <option value="dap_an_1">Đáp án loại 1</option>
                                <option value="dap_an_2">Đáp án loại 2</option>
                                <option value="dap_an_3">Đáp án loại 3</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Trộn Đề</button>
                </form>
            </div>
        </div>
        <div class="mt-5" id="resultSection" style="display: none;">
            <h2>Kết quả:</h2>
            <div id="results"></div>
        </div>
        <table id="latexTable" class="table mt-3">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>ID</th>
                    <th>ID Ý NGHĨA</th>
                    <th>Nội dung câu hỏi</th>
                    <th>Không Trộn</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>



    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    
    <script>
function loadJSON(filePath, callback) {
        var xhr = new XMLHttpRequest();
        xhr.overrideMimeType("application/json");
        xhr.open('GET', filePath, true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                callback(JSON.parse(xhr.responseText));
            }
        };
        xhr.send(null);
    }

function copyToClipboard(text) {
            let tempTextarea = document.createElement('textarea');
            tempTextarea.value = text;
            document.body.appendChild(tempTextarea);
            tempTextarea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextarea);
            alert('Đã copy nội dung vào clipboard!');
        }

function getPhieuToContent(phieuTo) {
        switch (phieuTo) {
            case 'phieu0':
                return ``;
            case 'phieu1':
                return `\\begin{center}
      \\resizebox{0.88\\textwidth}{!}{
         \\begin{tikzpicture}[line join = round, line cap =round,>=stealth,very thin,font=\\footnotesize,scale=1.25]
			\\def \\x{-8.4}\\def \\y{-11}
			\\def \\a{-6.95}\\def \\b{-10.475}		
			%%SBD
			\\foreach \\x in {0,1,...,6}{\\draw[violet] (3.71+0.3*\\x,8.85)--(3.71+0.3*\\x,4.5);}
			\\foreach \\j in {0,1,...,10}{\\draw[violet] (3.71,8.85-0.435*\\j)--(3.71+0.3*6,8.85-0.435*\\j);}
			\\foreach \\j in {0,1,...,5}{
			\\foreach \\x in {0,1,...,9}{\\draw[blue] (3.86+\\j*0.3,8.64-\\x*0.435) circle (3.65pt);}}
			\\foreach \\x in {0,1,...,9}{\\draw[blue] (3.86-0.4,8.64-\\x*0.435) circle (3.65pt) node{\\x};}
			\\draw[violet] (3.86+0.45,9.6) node{\\footnotesize\\textbf{7.Số báo danh}};
			\\foreach \\x in {0,1,...,6}{\\draw[violet] (3.86-0.15+0.3*\\x,9.4)--(3.86-0.15+0.3*\\x,8.965);}			
			\\foreach \\j in {0,1}{\\draw[violet] (3.71,9.4-0.435*\\j)--(5.51,9.4-0.435*\\j);}		
			%%MÃ ĐỀ	
			\\foreach \\x in {0,1,2,3}{\\draw[violet] (6.11-0.15+0.3*\\x,8.85)--(6.11-0.15+0.3*\\x,4.5);}
			\\foreach \\j in {0,1,...,10}{\\draw[violet] (5.96,8.85-0.435*\\j)--(6.86,8.85-0.435*\\j);}
			\\draw[violet] (6.25,9.6) node{\\footnotesize\\textbf{8.Mã đề thi}};
			\\foreach \\x in {0,1,2,3}{\\draw[violet] (6.11-0.15+0.3*\\x,9.4)--(6.11-0.15+0.3*\\x,8.965);}			
			\\foreach \\j in {0,1}{\\draw[violet] (5.96,9.4-0.435*\\j)--(6.86,9.4-0.435*\\j);}			
			\\foreach \\j in {0,1,2}{
			\\foreach \\x in {0,1,...,9}{\\draw[blue] (6.11+\\j*0.3,8.64-\\x*0.435) circle (3.65pt);}}
				\\foreach \\x in {0,1,...,9}{\\draw[blue] (7.11,8.64-\\x*0.435) circle (3.65pt) node{\\x};}
			%%PHẦN 1-10
			\\begin{scope}			
				\\draw[fill=blue] (-6.1+2.92,-.865) rectangle++ (0.2,0.2);
				\\draw[fill=blue] (-6.1+2.92,-.865+3.88) rectangle++ (0.2,0.2);
				\\draw[blue,rounded corners, thick] (-6.1,-.8) rectangle++ (2.8,3.92);
				\\draw[blue] (-5.65+0*0.63,3.1308+0.3) node {\\textbf{PHẦN I}};
				\\draw[blue] (-5.65+0.15+0*0.645,3.1308-0.185) node {\\tiny A};
				\\draw[blue] (-5.65+0.15+1*0.645,3.1308-0.185) node {\\tiny B};
				\\draw[blue] (-5.65+0.15+2*0.645,3.1308-0.185) node {\\tiny C};
				\\draw[blue] (-5.65+0.15+3*0.645,3.1308-0.185) node {\\tiny D};								
				\\foreach \\x in {1,2,...,10}{\\draw (-5.65-0.4+0.15+0*0.64,3.1308-\\x*0.34-0.18) node {\\tiny \\x};}
				\\foreach \\j in {0,1,2,3}{\\foreach \\x in {1,2,...,10}{\\draw[blue] (-5.65+0.15+\\j*0.645,3.1308-\\x*0.34-0.185) circle (3.65pt);}}						
			\\end{scope}	
			\\begin{scope}[shift={(3.25,0)}]		
			\\draw[fill=blue] (-6.1+2.92,-.865) rectangle++ (0.2,0.2);
			\\draw[fill=blue] (-6.1+2.92,-.865+3.88) rectangle++ (0.2,0.2);
			\\draw[blue,rounded corners, thick] (-6.1,-.8) rectangle++ (2.8,3.92);
			\\draw[blue] (-5.65+0.15+0*0.645,3.1308-0.185) node {\\tiny A};
			\\draw[blue] (-5.65+0.15+1*0.645,3.1308-0.185) node {\\tiny B};
			\\draw[blue] (-5.65+0.15+2*0.645,3.1308-0.185) node {\\tiny C};
			\\draw[blue] (-5.65+0.15+3*0.645,3.1308-0.185) node {\\tiny D};								
			\\foreach \\x in {1,2,...,10}{
			\\pgfmathtruncatemacro{\\result}{\\x + 10}
			\\draw (-5.65-0.4+0.15+0*0.64,3.1308-\\x*0.34-0.18) node {\\tiny \\result};}
			\\foreach \\j in {0,1,2,3}{\\foreach \\x in {1,2,...,10}{\\draw[blue] (-5.65+0.15+\\j*0.645,3.1308-\\x*0.34-0.185) circle (3.65pt);}}						
		\\end{scope}				
		\\begin{scope}[shift={(3.25*2,0)}]		
			\\draw[fill=blue] (-6.1+2.92,-.865) rectangle++ (0.2,0.2);
			\\draw[fill=blue] (-6.1+2.92,-.865+3.88) rectangle++ (0.2,0.2);
			\\draw[blue,rounded corners, thick] (-6.1,-.8) rectangle++ (2.8,3.92);
			\\draw[blue] (-5.65+0.15+0*0.645,3.1308-0.185) node {\\tiny A};
			\\draw[blue] (-5.65+0.15+1*0.645,3.1308-0.185) node {\\tiny B};
			\\draw[blue] (-5.65+0.15+2*0.645,3.1308-0.185) node {\\tiny C};
			\\draw[blue] (-5.65+0.15+3*0.645,3.1308-0.185) node {\\tiny D};								
			\\foreach \\x in {1,2,...,10}{
				\\pgfmathtruncatemacro{\\result}{\\x + 20}
				\\draw (-5.65-0.4+0.15+0*0.64,3.1308-\\x*0.34-0.18) node {\\tiny \\result};}
			\\foreach \\j in {0,1,2,3}{\\foreach \\x in {1,2,...,10}{\\draw[blue] (-5.65+0.15+\\j*0.645,3.1308-\\x*0.34-0.185) circle (3.65pt);}}						
		\\end{scope}
		\\begin{scope}[shift={(3.25*3,0)}]		
			\\draw[blue,rounded corners, thick] (-6.1,-.8) rectangle++ (2.8,3.92);
			\\draw[blue] (-5.65+0.15+0*0.645,3.1308-0.185) node {\\tiny A};
			\\draw[blue] (-5.65+0.15+1*0.645,3.1308-0.185) node {\\tiny B};
			\\draw[blue] (-5.65+0.15+2*0.645,3.1308-0.185) node {\\tiny C};
			\\draw[blue] (-5.65+0.15+3*0.645,3.1308-0.185) node {\\tiny D};								
			\\foreach \\x in {1,2,...,10}{
				\\pgfmathtruncatemacro{\\result}{\\x + 30}
				\\draw (-5.65-0.4+0.15+0*0.64,3.1308-\\x*0.34-0.18) node {\\tiny \\result};}
			\\foreach \\j in {0,1,2,3}{\\foreach \\x in {1,2,...,10}{\\draw[blue] (-5.65+0.15+\\j*0.645,3.1308-\\x*0.34-0.185) circle (3.65pt);}}						
		\\end{scope}
		%%Phần II-Câu 1
		\\begin{scope}		
			\\draw[fill=blue] (-6.1+2.92,-1.42) rectangle++ (0.2,0.2);	
			\\draw[fill=blue] (-6.1+2.92,-1.42-2.28) rectangle++ (0.2,0.2);	
			\\draw[green] (-6.1+1.51,-1.3)--++(-90:2.29);	
			\\draw[purple,rounded corners, thick] (-6.1,-3.6) rectangle ++(2.8,2.3);			
			\\draw[blue] (-5.65,-2.25+0.75+0.5)node {\\textbf{PHẦN II}};
			\\draw (-5.65+0.2,-2.25+0.75)node {Câu 1};
			\\draw (-5.65,-2.25+0.4)node {Đúng};
			\\draw (-5.65+0.64,-2.25+0.4)node {Sai};
			\\draw (-5.65-0.3,-2.25-0*0.3458)node {a)};
			\\draw (-5.65-0.3,-2.25-1*0.3458)node {b)};
			\\draw (-5.65-0.3,-2.25-2*0.3458)node {c)};
			\\draw (-5.65-0.3,-2.25-3*0.3458)node {d)};
			\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}
			\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}			
			%%Phần II-Câu 2	
			\\begin{scope}[shift={(1.3,0)}]
			\\draw (-5.65+0.3,-2.25+0.75)node {Câu 2};
			\\draw (-5.65+0.1,-2.25+0.4)node {Đúng};
			\\draw (-5.65+0.64+0.1,-2.25+0.4)node {Sai};
			\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}
			\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}
			\\end{scope}					
		\\end{scope}		
		\\begin{scope}[shift={(3.255,0)}]		
			\\draw[fill=blue] (-6.1+2.92,-1.42) rectangle++ (0.2,0.2);	
			\\draw[fill=blue] (-6.1+2.92,-1.42-2.28) rectangle++ (0.2,0.2);	
			\\draw[green] (-6.1+1.51,-1.3)--++(-90:2.29);	
			\\draw[purple,rounded corners, thick] (-6.1,-3.6) rectangle ++(2.8,2.3);			
			\\draw (-5.65+0.2,-2.25+0.75)node {Câu 3};
			\\draw (-5.65,-2.25+0.4)node {Đúng};
			\\draw (-5.65+0.64,-2.25+0.4)node {Sai};
			\\draw (-5.65-0.3,-2.25-0*0.3458)node {a)};
			\\draw (-5.65-0.3,-2.25-1*0.3458)node {b)};
			\\draw (-5.65-0.3,-2.25-2*0.3458)node {c)};
			\\draw (-5.65-0.3,-2.25-3*0.3458)node {d)};
			\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}
			\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}			
			%%Phần II-Câu 2	
			\\begin{scope}[shift={(1.3,0)}]
				\\draw (-5.65+0.3,-2.25+0.75)node {Câu 4};
				\\draw (-5.65+0.1,-2.25+0.4)node {Đúng};
				\\draw (-5.65+0.64+0.1,-2.25+0.4)node {Sai};
				\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}
				\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}
			\\end{scope}					
		\\end{scope}	
		\\begin{scope}[shift={(3.255*2,0)}]		
			\\draw[fill=blue] (-6.1+2.92,-1.42) rectangle++ (0.2,0.2);	
			\\draw[fill=blue] (-6.1+2.92,-1.42-2.28) rectangle++ (0.2,0.2);	
			\\draw[green] (-6.1+1.51,-1.3)--++(-90:2.29);	
			\\draw[purple,rounded corners, thick] (-6.1,-3.6) rectangle ++(2.8,2.3);			
			\\draw (-5.65+0.2,-2.25+0.75)node {Câu 5};
			\\draw (-5.65,-2.25+0.4)node {Đúng};
			\\draw (-5.65+0.64,-2.25+0.4)node {Sai};
			\\draw (-5.65-0.3,-2.25-0*0.3458)node {a)};
			\\draw (-5.65-0.3,-2.25-1*0.3458)node {b)};
			\\draw (-5.65-0.3,-2.25-2*0.3458)node {c)};
			\\draw (-5.65-0.3,-2.25-3*0.3458)node {d)};
			\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}
			\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}			
			%%Phần II-Câu 2	
			\\begin{scope}[shift={(1.3,0)}]
				\\draw (-5.65+0.3,-2.25+0.75)node {Câu 6};
				\\draw (-5.65+0.1,-2.25+0.4)node {Đúng};
				\\draw (-5.65+0.64+0.1,-2.25+0.4)node {Sai};
				\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}
				\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}
			\\end{scope}					
		\\end{scope}
		\\begin{scope}[shift={(3.255*3,0)}]		
			\\draw[green] (-6.1+1.51,-1.3)--++(-90:2.29);	
			\\draw[purple,rounded corners, thick] (-6.1,-3.6) rectangle ++(2.8,2.3);			
			\\draw (-5.65+0.2,-2.25+0.75)node {Câu 7};
			\\draw (-5.65,-2.25+0.4)node {Đúng};
			\\draw (-5.65+0.64,-2.25+0.4)node {Sai};
			\\draw (-5.65-0.3,-2.25-0*0.3458)node {a)};
			\\draw (-5.65-0.3,-2.25-1*0.3458)node {b)};
			\\draw (-5.65-0.3,-2.25-2*0.3458)node {c)};
			\\draw (-5.65-0.3,-2.25-3*0.3458)node {d)};
			\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}
			\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}			
			%%Phần II-Câu 2	
			\\begin{scope}[shift={(1.3,0)}]
				\\draw (-5.65+0.3,-2.25+0.75)node {Câu 8};
				\\draw (-5.65+0.1,-2.25+0.4)node {Đúng};
				\\draw (-5.65+0.64+0.1,-2.25+0.4)node {Sai};
				\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}
				\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.65+0.65+0.125,-2.25-0.03-\\x*0.335) circle (3.65pt);}
			\\end{scope}					
		\\end{scope}
		%%PHẦN III
		\\draw[blue] (-5.65,-4.105+0.1) node[above]{\\textbf{PHẦN III}};
		\\foreach \\i in {0,...,5}{		
		\\draw[thick,violet, rounded corners] (-6.1+\\i*12.5/6,-9.4) rectangle++ (12.5/6,5.2);}
		\\foreach \\y in {0,1,3,4}{
			\\pgfmathtruncatemacro{\\kq}{\\y+1}
			\\begin{scope}[shift={(2.083*\\y,0)}]
			\\draw[fill=blue] (-4.1,-3.98) rectangle++(0.2,0.2);
			\\draw[fill=blue] (-4.1,-3.98-5.875) rectangle++(0.2,0.2);
			\\draw[blue] (-5.64,-5.27) circle (3.65pt);			
			\\draw[blue] (-5.995+0.75,-5.105+0.65-0.1) node[above]{Câu \\kq};
			\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.8+0.41*\\x,-5) rectangle ++(0.41,0.35);}			
			\\draw(-5.64-0.3,-5.27+0*0.345) node {$\\textbf{-}$};
			\\draw(-5.64-0.3,-5.27-0.345) node {$\\textbf{,}$};
			\\foreach \\i in {2,3,...,11}{\\draw[blue] (-5.64,-5.27-0.345*\\i) circle (3.65pt);}
			\\foreach \\i in {1,2,3,...,11}{\\draw[blue] (-5.64+0.45,-5.27-0.345*\\i) circle (3.65pt);}	
			\\foreach \\i in {1,2,3,...,11}{\\draw[blue] (-5.64+0.45*2,-5.27-0.345*\\i) circle (3.65pt);}
			\\foreach \\i in {2,3,...,11}{\\draw[blue] (-5.64+0.45*3,-5.27-0.345*\\i) circle (3.65pt);}		
			%%thêm số
			\\foreach \\i in {2,3,...,11}{
				\\pgfmathtruncatemacro{\\result}{\\i -2}
				\\draw[blue] (-5.64-0.3,-5.27-0.345*\\i)node{\\tiny \\result};}			
		\\end{scope}}
	\\begin{scope}[shift={(2.083*2,0)}]
		\\draw[blue] (-5.64,-5.27) circle (3.65pt);	
		\\draw[fill=blue] (-4.1,-3.98-5.875) rectangle++(0.2,0.2);		
		\\draw[blue] (-5.995+0.75,-5.105+0.65-0.1) node[above]{Câu 3};
		\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.8+0.41*\\x,-5) rectangle ++(0.41,0.35);}			
		\\draw(-5.64-0.3,-5.27+0*0.345) node {$\\textbf{-}$};
		\\draw(-5.64-0.3,-5.27-0.345) node {$\\textbf{,}$};
		\\foreach \\i in {2,3,...,11}{\\draw[blue] (-5.64,-5.27-0.345*\\i) circle (3.65pt);}
		\\foreach \\i in {1,2,3,...,11}{\\draw[blue] (-5.64+0.45,-5.27-0.345*\\i) circle (3.65pt);}	
		\\foreach \\i in {1,2,3,...,11}{\\draw[blue] (-5.64+0.45*2,-5.27-0.345*\\i) circle (3.65pt);}
		\\foreach \\i in {2,3,...,11}{\\draw[blue] (-5.64+0.45*3,-5.27-0.345*\\i) circle (3.65pt);}		
		%%thêm số
		\\foreach \\i in {2,3,...,11}{
			\\pgfmathtruncatemacro{\\result}{\\i -2}
			\\draw[blue] (-5.64-0.3,-5.27-0.345*\\i)node{\\tiny \\result};}			
	\\end{scope}
	\\begin{scope}[shift={(2.083*5,0)}]
		\\draw[blue] (-5.64,-5.27) circle (3.65pt);			
		\\draw[blue] (-5.995+0.75,-5.105+0.65-0.1) node[above]{Câu 6};
		\\foreach \\x in {0,1,2,3}{\\draw[blue] (-5.8+0.41*\\x,-5) rectangle ++(0.41,0.35);}			
		\\draw(-5.64-0.3,-5.27+0*0.345) node {$\\textbf{-}$};
		\\draw(-5.64-0.3,-5.27-0.345) node {$\\textbf{,}$};
		\\foreach \\i in {2,3,...,11}{\\draw[blue] (-5.64,-5.27-0.345*\\i) circle (3.65pt);}
		\\foreach \\i in {1,2,3,...,11}{\\draw[blue] (-5.64+0.45,-5.27-0.345*\\i) circle (3.65pt);}	
		\\foreach \\i in {1,2,3,...,11}{\\draw[blue] (-5.64+0.45*2,-5.27-0.345*\\i) circle (3.65pt);}
		\\foreach \\i in {2,3,...,11}{\\draw[blue] (-5.64+0.45*3,-5.27-0.345*\\i) circle (3.65pt);}		
		%%thêm số
		\\foreach \\i in {2,3,...,11}{
			\\pgfmathtruncatemacro{\\result}{\\i -2}
			\\draw[blue] (-5.64-0.3,-5.27-0.345*\\i)node{\\tiny \\result};}			
	\\end{scope}
	\\draw[green, rounded corners,thick] (\\a-0.3,\\b-0.3) rectangle ++(15-0.1,21.5);%%HCN
	\\draw[fill=blue] (\\a,\\b) rectangle (\\a+0.4,\\b+0.4);%%trái dưới
	\\draw[fill=blue] (\\a,\\b+14.13) rectangle (\\a+0.4,\\b+0.4+14.13);
	\\draw[fill=blue] (-\\a-0.06,\\b) rectangle (-\\a-0.06+0.4,\\b+0.4);%%phải dưới
	\\draw[fill=blue] (-\\a-0.06,\\b+14.13+0.245) rectangle ++(0.4,0.4);
	\\draw[fill=blue] (-\\a-0.035-3.615,\\b+14.13+0.245) rectangle ++(0.4,0.4);
	\\draw[fill=blue] (-\\a-0.06-1.25,\\b+14.13+0.755) rectangle ++(0.2,0.2);
	\\draw[fill=blue] (-\\a-0.06-1.25,\\b+14.13+0.75+2.18) rectangle ++(0.2,0.2);
	\\draw[fill=blue] (-\\a-0.06-3.615,-\\b-0.515) rectangle (-\\a-0.06+0.4-3.615,-\\b-0.515+0.4);
	\\draw[fill=blue] (-\\a-0.06,-\\b-0.515) rectangle ++(0.4,0.4);%%phải trên
	\\draw[fill=blue] (\\a,-\\b-0.515) rectangle  ++(0.4,0.4);%%trái trên
	%%Thông tin
	\\draw[thick,violet] (-6.6,4.5) rectangle (-3.4,8.6);
	\\draw[violet] (-5,8.15) node[align=center]{Họ tên, chữ ký\\\\của cán bộ coi thị 1};
	\\draw[violet] (-5,6.25) node[align=center]{Họ tên, chữ ký\\\\của cán bộ coi thị 2};
	\\draw[thick,violet] (-6.6,6.55)--(-3.4,6.55);
	\\draw[thick,violet](-3.25,8.6) rectangle (3.2,4.5);
	\\node[align=left] at (.5,6.5) {
		\\begin{minipage}{10cm}
			\\begin{enumerate}
				\\setlength\\itemsep{1.15em}
				\\item Hội đồng thi ......................................................
				\\item Điểm thi ............................................................
				\\item Phòng thì số ......................................................
				\\item Họ và tên thí sinh ..............................................
				\\item Ngày sinh ........./........./..............(Nam/Nữ).......
				\\item Chữ ký của thí sinh ...........................................
			\\end{enumerate}
		\\end{minipage}
	};
	\\node[align=left] at (-2.5,8.95) {
		\\begin{minipage}{10cm}
			Bài Thi:.....................................................Ngày Thi:....................
		\\end{minipage}
	};
	\\node[align=left] at (-.5,9.5) {
		\\begin{minipage}{6cm}
			Kỳ Thi:.....................................................
		\\end{minipage}
	};
	\\node[align=left] at (-1.5,10) {
		\\begin{minipage}{8cm}
			\\textbf{PHIẾU TRẢ LỜI TRẮC NGHIỆM}
		\\end{minipage}
	};
		\\end{tikzpicture}
  }
     \\end{center}`;
            case 'phieu2':
                return `\\begin{center}
      \\resizebox{0.88\\textwidth}{!}{
         \\begin{tikzpicture}[line join = round, line cap =round,>=stealth,very thin,font=\\footnotesize,scale=1.25]			
			\\def \\x{-8.4}\\def \\y{-11}
			\\def \\a{-7}\\def \\b{-10.1}			
			\\draw[thick,double,rounded corners, double, cyan] (\\a-0.3,\\b-0.3) rectangle++(15,20.7);
			\\draw[fill=blue] (\\a,\\b) rectangle (\\a+0.37,\\b+0.37);%%trái dưới
			\\draw[fill=blue] (-\\a-0.02,\\b) rectangle (-\\a-0.02+0.37,\\b+0.37);%%phải dưới
			\\draw[fill=blue] (-\\a-0.03,-\\b-0.49) rectangle (-\\a-0.03+0.37,-\\b-0.49+0.37);%%phải trên
			\\draw[fill=blue] (\\a,-\\b-0.49) rectangle (\\a+0.37,-\\b-0.49+0.37);%%trái trên						
			\\draw[fill=blue] (-\\a+0.055,\\b+6.035) rectangle++(0.21,0.21);
			\\draw[fill=blue] (-\\a+0.055,\\b+8.97) rectangle++(0.21,0.21);
			\\draw[fill=blue] (-\\a+0.055,\\b+13.626) rectangle++(0.21,0.21);
			%\\draw[fill=blue] (-\\a-0.06-3.615,\\b+14.13) rectangle++(0.21,0.21);
			%\\draw[blue] (-\\a-0.06-3.615,-\\b-0.515) rectangle (-\\a-0.06+0.4-3.615,-\\b-0.515+0.4);		
			%%PHẦN 1-10
			\\begin{scope}
				\\draw[fill=blue] (\\a+0.078,\\b+9.035-0.065) rectangle++(0.21,0.21);
				\\draw[fill=blue] (\\a+0.078,\\b+13.627) rectangle++(0.21,0.21);			
				\\draw[rounded corners, double,magenta] (-6.7,-.65) rectangle (-6.33+2.865,3.33);
				\\draw[blue] (-6+0.5+0*0.73,3.1308+0.5) node {\\textbf{PHẦN I}};
				\\draw[blue] (-6+0*0.73,3.1308+0.02) node {A};
				\\draw[blue] (-6+1*0.73,3.1308+0.02) node {B};	
				\\draw[blue] (-6+2*0.73,3.1308+0.02) node {C};
				\\draw[blue] (-6+3*0.73,3.1308+0.02) node {D};				
				\\foreach \\x in {1,2,...,10}{\\draw (-6-0.4,3.03-\\x*0.342) node {\\tiny\\x};}
				\\foreach \\j in {0,1,2,3}{\\foreach \\x in {1,2,...,10}{\\draw[blue] (-6+\\j*0.73,3.03-\\x*0.342) circle (3.56pt);}}						
			\\end{scope}
			%%PHẦN 11-20
			\\begin{scope}[shift={(0:3.495)}]
				\\draw[fill=blue] (\\a+0.078,\\b+9.035-0.065) rectangle++(0.21,0.21);
				\\draw[fill=blue] (\\a+0.078,\\b+13.627) rectangle++(0.21,0.21);			
				\\draw[rounded corners, double,magenta] (-6.7,-.65) rectangle (-6.33+2.865,3.33);
				\\draw[blue] (-6+0*0.73,3.1308+0.02) node {A};
				\\draw[blue] (-6+1*0.73,3.1308+0.02) node {B};	
				\\draw[blue] (-6+2*0.73,3.1308+0.02) node {C};
				\\draw[blue] (-6+3*0.73,3.1308+0.02) node {D};				
				\\foreach \\x in {1,2,...,10}{
				\\pgfmathtruncatemacro{\\result}{\\x + 10}
				\\draw (-6-0.4,3.03-\\x*0.342) node {\\tiny\\result};}
				\\foreach \\j in {0,1,2,3}{\\foreach \\x in {1,2,...,10}{\\draw[blue] (-6+\\j*0.73,3.03-\\x*0.342) circle (3.56pt);}}						
			\\end{scope}
				%%PHẦN 21-30
			\\begin{scope}[shift={(0:3.495*2)}]
				\\draw[fill=blue] (\\a+0.078,\\b+9.035-0.065) rectangle++(0.21,0.21);
				\\draw[fill=blue] (\\a+0.078,\\b+13.627) rectangle++(0.21,0.21);			
				\\draw[rounded corners, double,magenta] (-6.7,-.65) rectangle (-6.33+2.865,3.33);
				\\draw[blue] (-6+0*0.73,3.1308+0.02) node {A};
				\\draw[blue] (-6+1*0.73,3.1308+0.02) node {B};	
				\\draw[blue] (-6+2*0.73,3.1308+0.02) node {C};
				\\draw[blue] (-6+3*0.73,3.1308+0.02) node {D};				
				\\foreach \\x in {1,2,...,10}{
					\\pgfmathtruncatemacro{\\result}{\\x + 20}
					\\draw (-6-0.4,3.03-\\x*0.342) node {\\tiny\\result};}
				\\foreach \\j in {0,1,2,3}{\\foreach \\x in {1,2,...,10}{\\draw[blue] (-6+\\j*0.73,3.03-\\x*0.342) circle (3.56pt);}}						
			\\end{scope}
			%%PHẦN 31-40
			\\begin{scope}[shift={(0:3.495*3)}]
				\\draw[fill=blue] (\\a+0.078,\\b+9.035-0.065) rectangle++(0.21,0.21);
				\\draw[rounded corners, double,magenta] (-6.7,-.65) rectangle (-6.33+2.865,3.33);
				\\draw[blue] (-6+0*0.73,3.1308+0.02) node {A};
				\\draw[blue] (-6+1*0.73,3.1308+0.02) node {B};	
				\\draw[blue] (-6+2*0.73,3.1308+0.02) node {C};
				\\draw[blue] (-6+3*0.73,3.1308+0.02) node {D};				
				\\foreach \\x in {1,2,...,10}{
					\\pgfmathtruncatemacro{\\result}{\\x + 30}
					\\draw (-6-0.4,3.03-\\x*0.342) node {\\tiny\\result};}
				\\foreach \\j in {0,1,2,3}{\\foreach \\x in {1,2,...,10}{\\draw[blue] (-6+\\j*0.73,3.03-\\x*0.342) circle (3.56pt);}}						
			\\end{scope}
			%%Phần II-Câu 1
			\\begin{scope}	
				\\draw[fill=blue] (\\a+0.078,\\b+6.038) rectangle++(0.21,0.21);		
				\\draw[thick,green] (-6.7,-3.65) rectangle (-6.2+2.72,-1.4);				
				\\draw[blue] (-5.65,-2.25+0.75+0.5)node {\\textbf{PHẦN II}};
				\\draw (-6+0.2,-2.4+0.75)node {Câu 1};
				\\draw (-6,-2.4+0.4)node {Đúng};
				\\draw (-6+0.73,-2.4+0.4)node {Sai};
				\\draw (-6-0.4,-2.4-0*0.3458)node {a)};
				\\draw (-6-0.4,-2.4-1*0.3458)node {b)};
				\\draw (-6-0.4,-2.4-2*0.3458)node {c)};
				\\draw (-6-0.4,-2.4-3*0.3458)node {d)};
				\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6,-2.4-\\x*0.3458) circle (3.56pt);}
				\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6+0.73,-2.4-\\x*0.3458) circle (3.56pt);}
				\\begin{scope}[shift={(0:0.73*2)}]
					\\draw (-6+0.2,-2.4+0.75)node {Câu 2};
					\\draw (-6,-2.4+0.4)node {Đúng};
					\\draw (-6+0.73,-2.4+0.4)node {Sai};
					\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6,-2.4-\\x*0.3458) circle (3.56pt);}
					\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6+0.73,-2.4-\\x*0.3458) circle (3.56pt);}
				\\end{scope}
			\\end{scope}	
			%%câu 3-4
			\\begin{scope}[shift={(0:3.495)}]
				\\draw[fill=blue] (\\a+0.078,\\b+6.038) rectangle++(0.21,0.21);		
				\\draw[thick,green] (-6.7,-3.65) rectangle (-6.2+2.72,-1.4);	
				\\draw (-6+0.2,-2.4+0.75)node {Câu 3};
				\\draw (-6,-2.4+0.4)node {Đúng};
				\\draw (-6+0.73,-2.4+0.4)node {Sai};
				\\draw (-6-0.4,-2.4-0*0.3458)node {a)};
				\\draw (-6-0.4,-2.4-1*0.3458)node {b)};
				\\draw (-6-0.4,-2.4-2*0.3458)node {c)};
				\\draw (-6-0.4,-2.4-3*0.3458)node {d)};
				\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6,-2.4-\\x*0.3458) circle (3.56pt);}
				\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6+0.73,-2.4-\\x*0.3458) circle (3.56pt);}
				\\begin{scope}[shift={(0:0.73*2)}]
					\\draw (-6+0.2,-2.4+0.75)node {Câu 4};
					\\draw (-6,-2.4+0.4)node {Đúng};
					\\draw (-6+0.73,-2.4+0.4)node {Sai};
					\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6,-2.4-\\x*0.3458) circle (3.56pt);}
					\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6+0.73,-2.4-\\x*0.3458) circle (3.56pt);}
				\\end{scope}
			\\end{scope}	
			%%câu 5-6
			\\begin{scope}[shift={(0:3.495*2)}]
				\\draw[fill=blue] (\\a+0.078,\\b+6.038) rectangle++(0.21,0.21);		
				\\draw[thick,green] (-6.7,-3.65) rectangle (-6.2+2.72,-1.4);	
				\\draw (-6+0.2,-2.4+0.75)node {Câu 5};
				\\draw (-6,-2.4+0.4)node {Đúng};
				\\draw (-6+0.73,-2.4+0.4)node {Sai};
				\\draw (-6-0.4,-2.4-0*0.3458)node {a)};
				\\draw (-6-0.4,-2.4-1*0.3458)node {b)};
				\\draw (-6-0.4,-2.4-2*0.3458)node {c)};
				\\draw (-6-0.4,-2.4-3*0.3458)node {d)};
				\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6,-2.4-\\x*0.3458) circle (3.56pt);}
				\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6+0.73,-2.4-\\x*0.3458) circle (3.56pt);}
				\\begin{scope}[shift={(0:0.73*2)}]
					\\draw (-6+0.2,-2.4+0.75)node {Câu 6};
					\\draw (-6,-2.4+0.4)node {Đúng};
					\\draw (-6+0.73,-2.4+0.4)node {Sai};
					\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6,-2.4-\\x*0.3458) circle (3.56pt);}
					\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6+0.73,-2.4-\\x*0.3458) circle (3.56pt);}
				\\end{scope}
			\\end{scope}	
			%%câu 7-8
			\\begin{scope}[shift={(0:3.495*3)}]
				\\draw[fill=blue] (\\a+0.078,\\b+6.038) rectangle++(0.21,0.21);		
				\\draw[thick,green] (-6.7,-3.65) rectangle (-6.2+2.72,-1.4);	
				\\draw (-6+0.2,-2.4+0.75)node {Câu 7};
				\\draw (-6,-2.4+0.4)node {Đúng};
				\\draw (-6+0.73,-2.4+0.4)node {Sai};
				\\draw (-6-0.4,-2.4-0*0.3458)node {a)};
				\\draw (-6-0.4,-2.4-1*0.3458)node {b)};
				\\draw (-6-0.4,-2.4-2*0.3458)node {c)};
				\\draw (-6-0.4,-2.4-3*0.3458)node {d)};
				\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6,-2.4-\\x*0.3458) circle (3.56pt);}
				\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6+0.73,-2.4-\\x*0.3458) circle (3.56pt);}
				\\begin{scope}[shift={(0:0.73*2)}]
					\\draw (-6+0.2,-2.4+0.75)node {Câu 8};
					\\draw (-6,-2.4+0.4)node {Đúng};
					\\draw (-6+0.73,-2.4+0.4)node {Sai};
					\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6,-2.4-\\x*0.3458) circle (3.56pt);}
					\\foreach \\x in {0,1,2,3}{\\draw[blue] (-6+0.73,-2.4-\\x*0.3458) circle (3.56pt);}
				\\end{scope}
			\\end{scope}	
			%%Phần III
			\\draw[blue] (-5.65,-4.105) node[above]{\\textbf{PHẦN III}};
			\\foreach \\x in {0,1,...,5}{\\draw[rounded corners, double,cyan] (-6.7+2.283*\\x,-4.4) rectangle++(2.283,-5.1);}
			\\foreach \\x in {0,1,...,5}{
			\\begin{scope}[shift={(0:2.325*\\x)}]
				\\pgfmathtruncatemacro{\\result}{\\x + 1}
				\\draw[blue] (-6,-5.5) circle (3.56pt);			
				\\draw[blue] (-6+0.35,-5.105+0.35) node[above]{Câu \\result};
				\\foreach \\x in {0,1,2,3} {
					\\draw[blue] (-6.15+\\x*0.345,-5.22) rectangle++(0.345,0.345);}
				\\draw(-6-0.4,-5.5) node {$\\textbf{-}$};
				\\draw(-6-0.4,-5.5-0.3458) node {$\\textbf{,}$};
				\\foreach \\i in {2,3,...,11}{\\draw[blue] (-6,-5.475-0.343*\\i) circle (3.56pt);}
				\\foreach \\i in {0,1,...,9}{\\draw (-6-0.4,-5.475-0.3565*2-0.343*\\i) node {\\tiny\\i};}
				\\foreach \\i in {1,2,3,...,11}{\\draw[blue] (-6+0.345,-5.475-0.343*\\i) circle (3.56pt);}
				\\foreach \\i in {1,2,3,...,11}{\\draw[blue] (-6+0.345*2,-5.475-0.343*\\i) circle (3.56pt);}
				\\foreach \\i in {2,3,...,11}{\\draw[blue] (-6+0.345*3,-5.475-0.343*\\i) circle (3.56pt);}
			\\end{scope}}
		\\begin{scope}[shift={(-90:5.95)}]
			\\draw[fill=blue] (\\a+2.4,\\b+6.038) rectangle++(0.21,0.21);
			\\draw[fill=blue] (\\a+4.74,\\b+6.038) rectangle++(0.21,0.21);
			\\draw[fill=blue] (\\a+9.39,\\b+6.038) rectangle++(0.21,0.21);
			\\draw[fill=blue] (\\a+11.72,\\b+6.038) rectangle++(0.21,0.21);
			\\draw[fill=blue] (\\a+4.74+2.33,\\b+6.038) rectangle++(0.21,0.21);
		\\end{scope}
		\\draw[fill=blue] (\\a+2.4,\\b+6.038) rectangle++(0.21,0.21);
		\\draw[fill=blue] (\\a+4.74,\\b+6.038) rectangle++(0.21,0.21);
		\\draw[fill=blue] (\\a+9.39,\\b+6.038) rectangle++(0.21,0.21);
		\\draw[fill=blue] (\\a+11.72,\\b+6.038) rectangle++(0.21,0.21);	
		%Mã đề
		\\foreach \\j in {0,1,2}{
			\\foreach \\x in {0,1,...,9}{
				\\draw[cyan] (6.25, 8.05+1.3) node{8. Mã đề thi};
				\\draw[cyan] (6.09+\\j*0.28-0.14, 8.05+0.395+0.395/2) rectangle++(0.28,0.395);				
				% Thêm đoạn mã này để vẽ hình chữ nhật trước khi vẽ hình tròn
				\\draw[cyan] (6.09+\\j*0.28-0.14, 8.05-\\x*0.395+0.395/2-0.395) rectangle++(0.28,0.395);
				% Vẽ hình tròn màu đỏ như trước
				\\draw[blue] (6.09+\\j*0.28,8.05-\\x*0.395) circle (2.9pt);
				\\draw[blue] (0.65+6.09+1*0.28,8.05-\\x*0.395) circle (2.9pt)node{\\tiny\\x};;}}
			\\draw[fill=blue] (5.59, 8.425)rectangle++(0.21,0.21);
			\\draw[fill=blue] (5.59, 3.89)rectangle++(0.21,0.21);
		%SBD
		\\begin{scope}[shift={(0:-2.35)}]
		\\foreach \\j in {0,1,2,3,4,5}{
			\\foreach \\x in {0,1,...,9}{
				\\draw[cyan] (6.5, 8.05+1.3) node{7. Số báo danh};
				\\draw[cyan] (6.09+\\j*0.28-0.14, 8.05+0.395+0.395/2) rectangle++(0.28,0.395);				
				% Thêm đoạn mã này để vẽ hình chữ nhật trước khi vẽ hình tròn
				\\draw[cyan] (6.09+\\j*0.28-0.14, 8.05-\\x*0.395+0.395/2-0.395) rectangle++(0.28,0.395);
				% Vẽ hình tròn màu đỏ như trước
				\\draw[blue] (6.09+\\j*0.28,8.05-\\x*0.395) circle (2.9pt);
				\\draw[blue] (0.65+6.09+1*0.28-1.33,8.05-\\x*0.395) circle (2.9pt)node{\\tiny\\x};;
			}}
		\\draw[fill=red] (5.57, 8.425)rectangle++(0.21,0.21);
		\\draw[fill=red] (5.57, 3.89)rectangle++(0.21,0.21);
		\\end{scope}
		%%Thông tin
		\\draw[thick,violet] (-6.6,4.5) rectangle (-3.4,8.6);
		\\draw[thick,violet] (-5,8.45) node{Họ tên, chữ ký};
		\\draw[thick,violet] (-5,8.3-0.05) node{của cán bộ coi thi 1};
		\\draw[thick,violet] (-6.6,6.55)--(-3.4,6.55);
		\\draw[thick,violet] (-5,6.4) node{Họ tên, chữ ký};
		\\draw[thick,violet] (-5,6.25-0.05) node{của cán bộ coi thi 2};
		\\draw[thick,violet](-3.25,8.6) rectangle (3.08,4.5);
		\\begin{minipage}{8cm}
        \\begin{enumerate}[leftmargin=*,label=\\arabic*.,itemsep=1.15em]
            \\item Hội đồng thi \\dotfill
            \\item Điểm thi \\dotfill
            \\item Phòng thi số \\dotfill
            \\item Họ và tên thí sinh \\dotfill
            \\item Ngày sinh \\dotfill (Nam/Nữ) \\dotfill
            \\item Chữ ký của thí sinh \\dotfill
        \\end{enumerate}
    \\end{minipage}
};	
		\\node[align=left] at (-2.5,8.95) {
			\\begin{minipage}{10cm}
				Bài Thi:.....................................................Ngày Thi:....................
			\\end{minipage}
		};
		\\node[align=left] at (-.5,9.5) {
			\\begin{minipage}{6cm}
				Kỳ Thi:.....................................................
			\\end{minipage}
		};
		\\node[align=left] at (-.5,10) {
			\\begin{minipage}{8cm}
				\\textbf{PHIẾU TRẢ LỜI TRẮC NGHIỆM}
			\\end{minipage}
		};
		\\end{tikzpicture}
  }
     \\end{center}`;
            case 'phieu3':
                return `\\begin{center}
      \\resizebox{0.88\\textwidth}{!}{
         \\begin{tikzpicture}[line join = round, line cap =round,>=stealth,very thin,font=\\footnotesize,scale=1]	
			%	\\draw[thick,red,rounded corners=5pt] (-10,-13.8) rectangle (9,13);	
			\\draw[thick,cyan] (-10,-13.5) rectangle (8.5,13.2);	
			\\draw[fill=blue] (-10,-13.5) rectangle (-10+0.8,-13.5+0.8);	
			\\draw[fill=blue] (-10,13.2) rectangle (-10+0.8,13.2-0.8);
			\\draw[fill=blue] (8.5,13.2) rectangle (8.5-0.8,13.2-0.8);	
			\\draw[fill=blue] (8.5,-13.5) rectangle (8.5-0.8,-13.5+0.8);
			%%Phần I
			\\draw[blue] (-9,5.275)node{\\textbf{PHẦN I}};	
			\\begin{scope}
				\\draw[fill=blue] (-9.475,4.275) rectangle (-9.475+0.425,4.275+0.425);	
				\\draw[fill=blue] (-9.475,4.275-4.5) rectangle (-9.475+0.425,4.275+0.425-4.5);					
				\\foreach \\x/\\letter in {0/A, 1/B, 2/C, 3/D}{
					\\draw (-9+0.15+0.41*\\x,4.5) circle (4.5pt) node at (-9+0.15+0.41*\\x,4.5) {\\tiny\\letter};}
				\\foreach \\y in {0,1,...,10}{
					\\foreach \\x in {0,1,2,3}{ \\draw (-9+0.15+0.41*\\x,4.5-0.41*\\y) circle (4.5pt);}}
				\\foreach \\y in {1,...,10}{
					\\foreach \\x in {-1}{ \\draw (-9+0.15+0.41*\\x,4.5-0.41*\\y) node{\\y};}}
			\\end{scope}
			\\begin{scope}[shift={(0:4.61)}]
				\\foreach \\x/\\letter in {0/A, 1/B, 2/C, 3/D}{
					\\draw (-9+0.15+0.41*\\x,4.5) circle (4.5pt) node at (-9+0.15+0.41*\\x,4.5) {\\tiny\\letter};}
				\\draw[fill=blue] (-9.475,4.275) rectangle (-9.475+0.425,4.275+0.425);	
				\\draw[fill=blue] (-9.475,4.275-4.5) rectangle (-9.475+0.425,4.275+0.425-4.5);	
				\\foreach \\y in {0,1,...,10}{
					\\foreach \\x in {0,1,2,3}{ \\draw (-9+0.15+0.41*\\x,4.5-0.41*\\y) circle (4.5pt);}}
				\\foreach \\y in {1,...,10}{
					\\foreach \\x in {-1}{ 
						\\pgfmathtruncatemacro{\\result}{\\y + 10}
						\\draw (-9+0.15+0.41*\\x,4.5-0.41*\\y) node{\\result};}}
			\\end{scope}
			\\begin{scope}[shift={(0:4.61*2)}]
				\\foreach \\x/\\letter in {0/A, 1/B, 2/C, 3/D}{
					\\draw (-9+0.15+0.41*\\x,4.5) circle (4.5pt) node at (-9+0.15+0.41*\\x,4.5) {\\tiny\\letter};}
				\\draw[fill=blue] (-9.475,4.275) rectangle (-9.475+0.425,4.275+0.425);	
				\\draw[fill=blue] (-9.475,4.275-4.5) rectangle (-9.475+0.425,4.275+0.425-4.5);	
				\\foreach \\y in {0,1,...,10}{
					\\foreach \\x in {0,1,2,3}{ \\draw (-9+0.15+0.41*\\x,4.5-0.41*\\y) circle (4.5pt);}}
				\\foreach \\y in {1,...,10}{
					\\foreach \\x in {-1}{ 
						\\pgfmathtruncatemacro{\\result}{\\y + 20}
						\\draw (-9+0.15+0.41*\\x,4.5-0.41*\\y) node{\\result};}}
			\\end{scope}
			\\begin{scope}[shift={(0:4.61*3)}]
				\\foreach \\x/\\letter in {0/A, 1/B, 2/C, 3/D}{
					\\draw (-9+0.15+0.41*\\x,4.5) circle (4.5pt) node at (-9+0.15+0.41*\\x,4.5) {\\tiny\\letter};}
				\\draw[fill=blue] (-9.475,4.275) rectangle (-9.475+0.425,4.275+0.425);	
				\\draw[fill=blue] (-9.475,4.275-4.5) rectangle (-9.475+0.425,4.275+0.425-4.5);	
				\\foreach \\y in {0,1,...,10}{
					\\foreach \\x in {0,1,2,3}{ \\draw (-9+0.15+0.41*\\x,4.5-0.41*\\y) circle (4.5pt);}}
				\\foreach \\y in {1,...,10}{
					\\foreach \\x in {-1}{ 
						\\pgfmathtruncatemacro{\\result}{\\y + 30}
						\\draw (-9+0.15+0.41*\\x,4.5-0.41*\\y) node{\\result};}}
			\\end{scope}	
			%%Phần II
			\\draw[blue] (-8.75,-.75)node{\\textbf{PHẦN II}};
			\\begin{scope}
				\\draw[blue] (-8.75,-1.275)node{Câu 1};
				\\draw[fill=blue] (-9.475,4.275-6.325) rectangle (-9.475+0.425,4.275+0.425-6.325);
				\\draw[fill=blue] (-9.475,4.275-6.325-2.05) rectangle (-9.475+0.425,4.275+0.425-6.325-2.05);					
				\\foreach \\y in {1,2,...,4}{
					\\foreach \\x in {0,1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) circle (4.5pt);}}
				\\foreach \\y in {0}{
					\\foreach \\x/\\kt in {0/Đ,1/S}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node{\\kt};}}					
				\\foreach \\y/\\letter in {1/a),2/b),3/c),4/d)}{
					\\foreach \\x in {-1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node {\\tiny\\letter};}}					
			\\end{scope}	
			\\begin{scope}[shift={(0:4.61*0.5)}]
				\\draw[blue] (-8.75,-1.275)node{Câu 2};
				\\draw[fill=blue] (-9.475,4.275-6.325) rectangle (-9.475+0.425,4.275+0.425-6.325);
				\\draw[fill=blue] (-9.475,4.275-6.325-2.05) rectangle (-9.475+0.425,4.275+0.425-6.325-2.05);					
				\\foreach \\y in {1,2,...,4}{
					\\foreach \\x in {0,1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) circle (4.5pt);}}
				\\foreach \\y in {0}{
					\\foreach \\x/\\kt in {0/Đ,1/S}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node{\\kt};}}					
				\\foreach \\y/\\letter in {1/a),2/b),3/c),4/d)}{
					\\foreach \\x in {-1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node {\\tiny\\letter};}}					
			\\end{scope}	
			\\begin{scope}[shift={(0:4.61*0.5*2)}]
				\\draw[blue] (-8.75,-1.275)node{Câu 3};
				\\draw[fill=blue] (-9.475,4.275-6.325) rectangle (-9.475+0.425,4.275+0.425-6.325);
				\\draw[fill=blue] (-9.475,4.275-6.325-2.05) rectangle (-9.475+0.425,4.275+0.425-6.325-2.05);					
				\\foreach \\y in {1,2,...,4}{
					\\foreach \\x in {0,1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) circle (4.5pt);}}
				\\foreach \\y in {0}{
					\\foreach \\x/\\kt in {0/Đ,1/S}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node{\\kt};}}					
				\\foreach \\y/\\letter in {1/a),2/b),3/c),4/d)}{
					\\foreach \\x in {-1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node {\\tiny\\letter};}}					
			\\end{scope}	
			\\begin{scope}[shift={(0:4.61*0.5*3)}]
				\\draw[blue] (-8.75,-1.275)node{Câu 4};
				\\draw[fill=blue] (-9.475,4.275-6.325) rectangle (-9.475+0.425,4.275+0.425-6.325);
				\\draw[fill=blue] (-9.475,4.275-6.325-2.05) rectangle (-9.475+0.425,4.275+0.425-6.325-2.05);					
				\\foreach \\y in {1,2,...,4}{
					\\foreach \\x in {0,1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) circle (4.5pt);}}
				\\foreach \\y in {0}{
					\\foreach \\x/\\kt in {0/Đ,1/S}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node{\\kt};}}					
				\\foreach \\y/\\letter in {1/a),2/b),3/c),4/d)}{
					\\foreach \\x in {-1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node {\\tiny\\letter};}}					
			\\end{scope}	
			\\begin{scope}[shift={(0:4.61*0.5*4)}]
				\\draw[blue] (-8.75,-1.275)node{Câu 5};
				\\draw[fill=blue] (-9.475,4.275-6.325) rectangle (-9.475+0.425,4.275+0.425-6.325);
				\\draw[fill=blue] (-9.475,4.275-6.325-2.05) rectangle (-9.475+0.425,4.275+0.425-6.325-2.05);					
				\\foreach \\y in {1,2,...,4}{
					\\foreach \\x in {0,1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) circle (4.5pt);}}
				\\foreach \\y in {0}{
					\\foreach \\x/\\kt in {0/Đ,1/S}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node{\\kt};}}					
				\\foreach \\y/\\letter in {1/a),2/b),3/c),4/d)}{
					\\foreach \\x in {-1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node {\\tiny\\letter};}}					
			\\end{scope}	
			\\begin{scope}[shift={(0:4.61*0.5*5)}]
				\\draw[blue] (-8.75,-1.275)node{Câu 6};
				\\draw[fill=blue] (-9.475,4.275-6.325) rectangle (-9.475+0.425,4.275+0.425-6.325);
				\\draw[fill=blue] (-9.475,4.275-6.325-2.05) rectangle (-9.475+0.425,4.275+0.425-6.325-2.05);					
				\\foreach \\y in {1,2,...,4}{
					\\foreach \\x in {0,1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) circle (4.5pt);}}
				\\foreach \\y in {0}{
					\\foreach \\x/\\kt in {0/Đ,1/S}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node{\\kt};}}					
				\\foreach \\y/\\letter in {1/a),2/b),3/c),4/d)}{
					\\foreach \\x in {-1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node {\\tiny\\letter};}}					
			\\end{scope}	
			\\begin{scope}[shift={(0:4.61*0.5*6)}]
				\\draw[blue] (-8.75,-1.275)node{Câu 7};
				\\draw[fill=blue] (-9.475,4.275-6.325) rectangle (-9.475+0.425,4.275+0.425-6.325);
				\\draw[fill=blue] (-9.475,4.275-6.325-2.05) rectangle (-9.475+0.425,4.275+0.425-6.325-2.05);					
				\\foreach \\y in {1,2,...,4}{
					\\foreach \\x in {0,1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) circle (4.5pt);}}
				\\foreach \\y in {0}{
					\\foreach \\x/\\kt in {0/Đ,1/S}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node{\\kt};}}					
				\\foreach \\y/\\letter in {1/a),2/b),3/c),4/d)}{
					\\foreach \\x in {-1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node {\\tiny\\letter};}}					
			\\end{scope}	
			\\begin{scope}[shift={(0:4.61*0.5*7)}]
				\\draw[blue] (-8.75,-1.275)node{Câu 8};
				\\draw[fill=blue] (-9.475,4.275-6.325) rectangle (-9.475+0.425,4.275+0.425-6.325);
				\\draw[fill=blue] (-9.475,4.275-6.325-2.05) rectangle (-9.475+0.425,4.275+0.425-6.325-2.05);					
				\\foreach \\y in {1,2,...,4}{
					\\foreach \\x in {0,1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) circle (4.5pt);}}
				\\foreach \\y in {0}{
					\\foreach \\x/\\kt in {0/Đ,1/S}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node{\\kt};}}					
				\\foreach \\y/\\letter in {1/a),2/b),3/c),4/d)}{
					\\foreach \\x in {-1}{ \\draw (-9+0.15+0.41*\\x,4.275+0.2-6.325-0.41*\\y) node {\\tiny\\letter};}}					
			\\end{scope}	
			%%PHẦN III
			\\draw[blue] (-8.75,-4.65)node{\\textbf{PHẦN III}};
			\\begin{scope}
				\\foreach \\y in {-5}{
					\\foreach \\x in {1,2,3,4}{
						\\draw (-9.45+3*0.41,-7.33-0.7+0.41*7) node{Câu 1};
						\\draw (-9.45+\\x*0.41,-7.33-0.8-0.41*\\y) rectangle ++(0.41,0.65);
					}
				}				
				\\draw[fill=blue] (-9.475,-6.72) rectangle (-9.475+0.425,-6.295);
				\\draw[fill=blue] (-9.475,-6.72-5.325) rectangle (-9.475+0.425,-6.295-5.325);
				\\draw[blue] (-9.475+0.21+0.41,-6.72-0.2) circle (4.5pt);
				\\draw[blue] (-9.475+0.21+0.41-0.41,-6.72-0.2) node{-};
				\\draw[blue] (-9.475+0.21+0.41-0.41,-6.72-0.2-0.41) node{,};
				\\draw[blue] (-9.475+0.21+0.41+0.41,-6.72-0.2-0.41)  circle (4.5pt);
				\\draw (-9.265+3*0.41,-7.33)  circle (4.5pt);
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {1,2,3,4}{
						\\draw (-9.265+\\x*0.41,-7.33-0.41-0.41*\\y)  circle (4.5pt);}}
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {0}{
						\\draw (-9.265+\\x*0.41,-7.33-0.41-0.41*\\y) node{\\y};}}
			\\end{scope}	
			\\begin{scope}[shift={(0:3.075)}]
				\\foreach \\y in {-5}{
					\\foreach \\x in {1,2,3,4}{
						\\draw (-9.45+3*0.41,-7.33-0.7+0.41*7) node{Câu 2};
						\\draw (-9.45+\\x*0.41,-7.33-0.8-0.41*\\y) rectangle ++(0.41,0.65);
					}
				}		
				\\draw[fill=blue] (-9.475,-6.72) rectangle (-9.475+0.425,-6.295);
				\\draw[fill=blue] (-9.475,-6.72-5.325) rectangle (-9.475+0.425,-6.295-5.325);
				\\draw[blue] (-9.475+0.21+0.41,-6.72-0.2) circle (4.5pt);
				\\draw[blue] (-9.475+0.21+0.41-0.41,-6.72-0.2) node{-};
				\\draw[blue] (-9.475+0.21+0.41-0.41,-6.72-0.2-0.41) node{,};
				\\draw[blue] (-9.475+0.21+0.41+0.41,-6.72-0.2-0.41)  circle (4.5pt);
				\\draw (-9.265+3*0.41,-7.33)  circle (4.5pt);
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {1,2,3,4}{
						\\draw (-9.265+\\x*0.41,-7.33-0.41-0.41*\\y)  circle (4.5pt);}}
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {0}{
						\\draw (-9.265+\\x*0.41,-7.33-0.41-0.41*\\y) node{\\y};}}
			\\end{scope}				
			\\begin{scope}[shift={(0:3.075*2)}]
				\\foreach \\y in {-5}{
					\\foreach \\x in {1,2,3,4}{
						\\draw (-9.45+3*0.41,-7.33-0.7+0.41*7) node{Câu 3};
						\\draw (-9.45+\\x*0.41,-7.33-0.8-0.41*\\y) rectangle ++(0.41,0.65);
					}
				}		
				\\draw[fill=blue] (-9.475,-6.72) rectangle (-9.475+0.425,-6.295);
				\\draw[fill=blue] (-9.475,-6.72-5.325) rectangle (-9.475+0.425,-6.295-5.325);
				\\draw[blue] (-9.475+0.21+0.41,-6.72-0.2) circle (4.5pt);
				\\draw[blue] (-9.475+0.21+0.41-0.41,-6.72-0.2) node{-};
				\\draw[blue] (-9.475+0.21+0.41-0.41,-6.72-0.2-0.41) node{,};
				\\draw[blue] (-9.475+0.21+0.41+0.41,-6.72-0.2-0.41)  circle (4.5pt);
				\\draw (-9.265+3*0.41,-7.33)  circle (4.5pt);
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {1,2,3,4}{
						\\draw (-9.265+\\x*0.41,-7.33-0.41-0.41*\\y)  circle (4.5pt);}}
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {0}{
						\\draw (-9.265+\\x*0.41,-7.33-0.41-0.41*\\y) node{\\y};}}
			\\end{scope}	
			\\begin{scope}[shift={(0:3.075*3)}]
				\\foreach \\y in {-5}{
					\\foreach \\x in {1,2,3,4}{
						\\draw (-9.45+3*0.41,-7.33-0.7+0.41*7) node{Câu 4};
						\\draw (-9.45+\\x*0.41,-7.33-0.8-0.41*\\y) rectangle ++(0.41,0.65);
					}
				}		
				\\draw[fill=blue] (-9.475,-6.72) rectangle (-9.475+0.425,-6.295);
				\\draw[fill=blue] (-9.475,-6.72-5.325) rectangle (-9.475+0.425,-6.295-5.325);
				\\draw[blue] (-9.475+0.21+0.41,-6.72-0.2) circle (4.5pt);
				\\draw[blue] (-9.475+0.21+0.41-0.41,-6.72-0.2) node{-};
				\\draw[blue] (-9.475+0.21+0.41-0.41,-6.72-0.2-0.41) node{,};
				\\draw[blue] (-9.475+0.21+0.41+0.41,-6.72-0.2-0.41)  circle (4.5pt);
				\\draw (-9.265+3*0.41,-7.33)  circle (4.5pt);
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {1,2,3,4}{
						\\draw (-9.265+\\x*0.41,-7.33-0.41-0.41*\\y)  circle (4.5pt);}}
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {0}{
						\\draw (-9.265+\\x*0.41,-7.33-0.41-0.41*\\y) node{\\y};}}
			\\end{scope}	
			\\begin{scope}[shift={(0:3.075*4)}]
				\\foreach \\y in {-5}{
					\\foreach \\x in {1,2,3,4}{
						\\draw (-9.45+3*0.41,-7.33-0.7+0.41*7) node{Câu 5};
						\\draw (-9.45+\\x*0.41,-7.33-0.8-0.41*\\y) rectangle ++(0.41,0.65);
					}
				}		
				\\draw[fill=blue] (-9.475,-6.72) rectangle (-9.475+0.425,-6.295);
				\\draw[fill=blue] (-9.475,-6.72-5.325) rectangle (-9.475+0.425,-6.295-5.325);
				\\draw[blue] (-9.475+0.21+0.41,-6.72-0.2) circle (4.5pt);
				\\draw[blue] (-9.475+0.21+0.41-0.41,-6.72-0.2) node{-};
				\\draw[blue] (-9.475+0.21+0.41-0.41,-6.72-0.2-0.41) node{,};
				\\draw[blue] (-9.475+0.21+0.41+0.41,-6.72-0.2-0.41)  circle (4.5pt);
				\\draw (-9.265+3*0.41,-7.33)  circle (4.5pt);
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {1,2,3,4}{
						\\draw (-9.265+\\x*0.41,-7.33-0.41-0.41*\\y)  circle (4.5pt);}}
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {0}{
						\\draw (-9.265+\\x*0.41,-7.33-0.41-0.41*\\y) node{\\y};}}
			\\end{scope}	
			\\begin{scope}[shift={(0:3.075*5)}]
				\\foreach \\y in {-5}{
					\\foreach \\x in {1,2,3,4}{
						\\draw (-9.45+3*0.41,-7.33-0.7+0.41*7) node{Câu 6};
						\\draw (-9.45+\\x*0.41,-7.33-0.8-0.41*\\y) rectangle ++(0.41,0.65);
					}
				}		
				\\draw[fill=blue] (-9.475,-6.72) rectangle (-9.475+0.425,-6.295);
				\\draw[fill=blue] (-9.475,-6.72-5.325) rectangle (-9.475+0.425,-6.295-5.325);
				\\draw[blue] (-9.475+0.21+0.41,-6.72-0.2) circle (4.5pt);
				\\draw[blue] (-9.475+0.21+0.41-0.41,-6.72-0.2) node{-};
				\\draw[blue] (-9.475+0.21+0.41-0.41,-6.72-0.2-0.41) node{,};
				\\draw[blue] (-9.475+0.21+0.41+0.41,-6.72-0.2-0.41)  circle (4.5pt);
				\\draw (-9.265+3*0.41,-7.33)  circle (4.5pt);
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {1,2,3,4}{
						\\draw (-9.265+\\x*0.41,-7.33-0.41-0.41*\\y)  circle (4.5pt);}}
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {0}{
						\\draw (-9.265+\\x*0.41,-7.33-0.41-0.41*\\y) node{\\y};}}
			\\end{scope}	
			%type
			\\foreach \\x in {0,1,...,7}{\\draw (-6.91+0.515*\\x,-12.8) circle (4.5pt);}
			\\foreach \\x in {0,1,5,7}{\\draw[fill=blue] (-6.91+0.515*\\x,-12.8) circle (4.5pt);}
			\\draw (-6.91-1,-12.8) node{\\textbf{Type}};
			\\draw[double,blue,rounded corners=5pt] (-6.91-0.25,-12.8-0.25) rectangle ++(4.1,0.5);
			%%MÃ ĐỀ
			\\begin{scope}
				\\draw[fill=blue] (6.165,10.435) rectangle ++(0.425,0.425);
				\\draw[fill=blue] (6.165,10.435-0.41*11) rectangle ++(0.425,0.425);
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {1,2,3}{\\draw (6.165+0.2+0.41*\\x,10.435-0.2-0.41*\\y) circle (4.5pt);}}
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {0}{\\draw (6.165+0.2+0.41*\\x,10.435-0.2-0.41*\\y)node{\\y};}}	
				\\foreach \\y in {-3}{
					\\foreach \\x in {1,2,3}{
						\\draw (6.165+0.1+0.41*2,10.3+0.41*4) node{8. Mã đề};
						\\draw (6.165+0.41*\\x,10.435-0.6-0.41*\\y) rectangle ++(0.41,0.65);
					}
				}	
			\\end{scope}		
			%%SBD
			\\begin{scope}[shift={(0:-3.725)}]
				\\draw[fill=blue] (6.165,10.435) rectangle ++(0.425,0.425);
				\\draw[fill=blue] (6.165,10.435-0.41*11) rectangle ++(0.425,0.425);
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {1,2,...,6}{\\draw (6.165+0.2+0.41*\\x,10.435-0.2-0.41*\\y) circle (4.5pt);}}
				\\foreach \\y in {0,1,...,9}{
					\\foreach \\x in {0}{\\draw (6.165+0.2+0.41*\\x,10.435-0.2-0.41*\\y)node{\\y};}}	
				\\foreach \\y in {-3}{
					\\foreach \\x in {1,2,3,4,5,6}{
						\\draw (6.165+0.5+0.1+0.41*2,10.3+0.41*4) node{7. Số báo danh};
						\\draw (6.165+0.41*\\x,10.435-0.6-0.41*\\y) rectangle ++(0.41,0.65);
					}
				}	
			\\end{scope}
			\\draw[blue] (-5.75,10.85) rectangle ++(7.75,-4.65);
			\\draw[blue] (-5.75-0.1,10.85) rectangle ++(-3.8,-4.65);
			\\draw[blue] (-5.75-0.1,10.85) rectangle ++(-3.8,-2.3);
			\\draw (-7.75,10.85-0.5) node[align=center]{Họ tên, chữ ký\\\\của cán bộ coi thị 1};
			\\draw (-7.75,10.85-0.5-2.3) node[align=center]{Họ tên, chữ ký\\\\của cán bộ coi thị 2};
			\\draw (-1,12.5) node[align=center]{\\large{\\textbf{PHIẾU TRẢ LỜI TRẮC NGHIỆM}}\\\\Kỳ thi: ........................};
			\\draw (-4,11.5) node[align=right]{Bài thi:......................................................Ngày thi:.................................};
			\\node[align=left] at (-1.85,8.5) {
				\\begin{minipage}{7.2cm}
					\\begin{enumerate}[leftmargin=*,label=\\arabic*.,itemsep=.8em]
							\\item Hội đồng thi \\dotfill
							\\item Điểm thi \\dotfill
							\\item Phòng thi số \\dotfill
							\\item Họ và tên thí sinh \\dotfill
							\\item Ngày sinh \\dotfill (Nam/Nữ) \\dotfill
							\\item Chữ ký của thí sinh \\dotfill
						\\end{enumerate}
				\\end{minipage}
			};	
		\\end{tikzpicture}
  }
     \\end{center}`;
            default:
                return `
\\section*{Phiếu Tô}
\\begin{itemize}
\\item Nội dung mặc định
\\end{itemize}
`;
        }
    }

        function extractChoices(text) {
            const regex = /\\choice\s*(\{[^}]*\})\s*(\{[^}]*\})\s*(\{[^}]*\})\s*(\{[^}]*\})/;
            const match = text.match(regex);
            if (match) {
                for (let i = 1; i <= 4; i++) {
                    if (match[i].includes('\\True')) {
                        return String.fromCharCode(64 + i); // Chuyển đổi sang A, B, C, D
                    }
                }
            }
            return ""; // Trả về chuỗi rỗng nếu không có lựa chọn đúng
        }
    
        function extractTrueFalse(text) {
            const regex = /\\choiceTF\s*(\{[^}]*\})\s*(\{[^}]*\})\s*(\{[^}]*\})\s*(\{[^}]*\})/;
            const match = text.match(regex);
            if (match) {
                return match.slice(1, 5).map(choice => choice.includes('\\True') ? 'Đ' : 'S').join('');
            }
            return "SSSS"; // Trả về SSSS nếu không có lựa chọn đúng/sai
        }
    
        function extractShortAnswer(text) {
            const regex = /\\shortans\{([^}]*)\}/;
            const match = text.match(regex);
            if (match) {
                return match[1].trim();
            }
            return ""; // Trả về chuỗi rỗng nếu không tìm thấy câu trả lời
        }
    
        function layCacNgoacLon(text) {
            let ngoacLon = [];
            let demNgoac = 0;
            let batDau = null;
    
            for (let i = 0; i < text.length; i++) {
                let kyTu = text[i];
                if (kyTu === "{") {
                    if (demNgoac === 0) {
                        batDau = i;
                    }
                    demNgoac += 1;
                } else if (kyTu === "}") {
                    demNgoac -= 1;
                    if (demNgoac === 0 && batDau !== null) {
                        let ketThuc = i;
                        ngoacLon.push([batDau, ketThuc]);
                        batDau = null;
                    }
                }
            }
    
            return ngoacLon;
        }
    
        function extractLatexData(content) {
            const regexType1 = /\\begin\{ex\}[^]*?\\choice\s*(?!TF\s*\{)\s*([^]*?)\\loigiai/gs;
            const regexType2 = /\\begin\{ex\}[^]*?\\choiceTF\s*([^]*?)\\loigiai/gs;
            const regexType3 = /\\begin\{ex\}[^]*?\\shortans\{([^\}]*)\}/gs;
    
            let matches, extractedData = [];
    
            while ((matches = regexType1.exec(content)) !== null) {
                let choices = matches[1].trim();
                let ngoacLon = layCacNgoacLon(choices);
                if (ngoacLon.length >= 4) {
                    let answers = ngoacLon.slice(0, 4).map(pair => choices.substring(pair[0] + 1, pair[1]));
                    let correctAnswerIndex = answers.findIndex(answer => answer.includes('\\True'));
                    if (correctAnswerIndex !== -1) {
                        extractedData.push(String.fromCharCode(65 + correctAnswerIndex)); // Chuyển đổi sang A, B, C, D
                    } else {
                        extractedData.push("N/A");
                    }
                } else {
                    extractedData.push("N/A");
                }
            }
    
            while ((matches = regexType2.exec(content)) !== null) {
                let choices = matches[1].trim();
                let ngoacLon = layCacNgoacLon(choices);
                if (ngoacLon.length >= 4) {
                    let answers = ngoacLon.slice(0, 4).map(pair => choices.substring(pair[0] + 1, pair[1]));
                    let result = answers.map(answer => answer.includes('\\True') ? 'Đ' : 'S').join('');
                    extractedData.push(result);
                } else {
                    extractedData.push("N/A");
                }
            }
    
            while ((matches = regexType3.exec(content)) !== null) {
                let answer = matches[1].trim();
                let ngoacLon = layCacNgoacLon(answer);
                if (ngoacLon.length > 0) {
                    answer = answer.substring(ngoacLon[0][0] + 1, ngoacLon[0][1]).trim();
                }
                extractedData.push(answer.replace(/\$|\{|\}/g, '').trim());
            }
    
            return extractedData;
        }
    
        function mergeExtractedData(allExtractedData, currentMades) {
            let headers = ['Câu\\Mã đề'];
            let maxLength = Math.max(...allExtractedData.map(data => data.length));
            let mergedData = [];
    
            currentMades.forEach((currentMade, index) => {
                headers.push(`${currentMade}`);
            });
    
            allExtractedData.forEach((data, index) => {
                for (let i = 0; i < maxLength; i++) {
                    if (!mergedData[i]) {
                        mergedData[i] = [i + 1];
                    }
                    mergedData[i].push(data[i] || "N/A");
                }
            });
    
            return [headers, ...mergedData];
        }
    
        function extractAndExport(files, currentMades) {
            const allExtractedData = files.map(fileContent => extractLatexData(fileContent));
            const mergedData = mergeExtractedData(allExtractedData, currentMades);
    
            const ws = XLSX.utils.aoa_to_sheet(mergedData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
            XLSX.writeFile(wb, "extracted_data.xlsx");
        }
    
        $(document).ready(function () {
            let idMeanings = {};

        // Load JSON file
        loadJSON('ynghia_id.json', function(data) {
            idMeanings = data;
        });

        function getIdMeaning(id) {
            return idMeanings[id] || "ID không xác định";
        }


            $('#uploadForm').on('submit', function (e) {
                e.preventDefault();
                let fileInput = document.getElementById('uploadFile');
                let file = fileInput ? fileInput.files[0] : null;
                let school = $('#school').val();
                let teacher = $('#teacher').val();
                let exam = $('#exam').val();
                let subject = $('#subject').val();
                let time = $('#time').val();
                let made = $('#made').val().split(',').map(item => item.trim());
                let numFiles = document.getElementById('numFiles') ? document.getElementById('numFiles').value : null;
                let hoanViType = document.getElementById('hoanViType') ? document.getElementById('hoanViType').value : 'ngoac';
                let headerType = document.getElementById('headerType') ? document.getElementById('headerType').value : 'default';
                let phieuTo = document.getElementById('phieuTo') ? document.getElementById('phieuTo').value : 'phieu1';
                let dapAn = document.getElementById('dapAn') ? document.getElementById('dapAn').value : 'dap_an_1';
    
                if (file) {
                    let reader = new FileReader();
                    reader.onload = function (event) {
                        let content = event.target.result;
                        parseFile(content, school, teacher, exam, subject, time, made, numFiles, hoanViType, headerType, phieuTo, dapAn);
                    };
                    reader.readAsText(file);
                }
            });
    
            $('#permuteButton').on('click', function () {
                let content = collectContentFromTable();
                let numFiles = document.getElementById('numFiles') ? document.getElementById('numFiles').value : null;
                let hoanViType = document.getElementById('hoanViType') ? document.getElementById('hoanViType').value : 'ngoac';
                let headerType = document.getElementById('headerType') ? document.getElementById('headerType').value : 'default';
    
                let school = $('#school').val();
                let teacher = $('#teacher').val();
                let exam = $('#exam').val();
                let subject = $('#subject').val();
                let time = $('#time').val();
                let made = $('#made').val().split(',').map(item => item.trim());
                let phieuTo = document.getElementById('phieuTo') ? document.getElementById('phieuTo').value : 'phieu1';
                let dapAn = document.getElementById('dapAn') ? document.getElementById('dapAn').value : 'dap_an_1';
    
                if (content && numFiles) {
                    let { results, files, currentMades } = generateFiles(content, numFiles, hoanViType, headerType, school, teacher, exam, subject, time, made, phieuTo, dapAn);
                    displayResults(results);
                    alert('Hoán vị xong!');
                }
            });
    
            $('#pasteForm').on('submit', function (e) {
                e.preventDefault();
                let content = $('#pasteContent').val();
                let numFiles = document.getElementById('numPasteFiles') ? document.getElementById('numPasteFiles').value : null;
                let hoanViType = document.getElementById('hoanViTypePaste') ? document.getElementById('hoanViTypePaste').value : 'ngoac';
                let headerType = document.getElementById('headerTypePaste') ? document.getElementById('headerTypePaste').value : 'default';
    
                let school = $('#school').val();
                let teacher = $('#teacher').val();
                let exam = $('#exam').val();
                let subject = $('#subject').val();
                let time = $('#time').val();
                let made = $('#made').val().split(',').map(item => item.trim());
                let phieuTo = document.getElementById('phieuToPaste') ? document.getElementById('phieuToPaste').value : 'phieu1';
                let dapAn = document.getElementById('dapAnPaste') ? document.getElementById('dapAnPaste').value : 'dap_an_1';
    
                if (content && numFiles) {
                    let { results, files, currentMades } = generateFiles(content, numFiles, hoanViType, headerType, school, teacher, exam, subject, time, made, phieuTo, dapAn);
                    displayResults(results);
                    alert('Hoán vị xong!');
                }
            });
    
            $('#downloadXlsxButton').on('click', function () {
                let content = collectContentFromTable();
                let numFiles = document.getElementById('numFiles') ? document.getElementById('numFiles').value : null;
                let hoanViType = document.getElementById('hoanViType') ? document.getElementById('hoanViType').value : 'ngoac';
                let headerType = document.getElementById('headerType') ? document.getElementById('headerType').value : 'default';
                let school = $('#school').val();
                let teacher = $('#teacher').val();
                let exam = $('#exam').val();
                let subject = $('#subject').val();
                let time = $('#time').val();
                let made = $('#made').val().split(',').map(item => item.trim());
                let phieuTo = document.getElementById('phieuTo') ? document.getElementById('phieuTo').value : 'phieu1';
                let dapAn = document.getElementById('dapAn') ? document.getElementById('dapAn').value : 'dap_an_1';
    
                if (content && numFiles) {
                    let { results, files, currentMades } = generateFiles(content, numFiles, hoanViType, headerType, school, teacher, exam, subject, time, made, phieuTo, dapAn);
                    displayResults(results);
                    extractAndExport(files, currentMades);
                    alert('Hoán vị và ghi Excel xong!');
                }
            });
    
          ////

        function extractLatexData2(content) {
            const regexType1 = /\\begin\{ex\}[^]*?\\choice\s*(?!TF\s*\{)\s*([^]*?)\\loigiai/gs;
            const regexType2 = /\\begin\{ex\}[^]*?\\choiceTF\s*([^]*?)\\loigiai/gs;
            const regexType3 = /\\begin\{ex\}[^]*?\\shortans\{([^\}]*)\}/gs;

            let matches, extractedData = { type1: [], type2: [], type3: [] };

            // Process Type 1 Questions (\choice)
            while ((matches = regexType1.exec(content)) !== null) {
                let choices = matches[1].trim();
                let ngoacLon = layCacNgoacLon(choices);
                if (ngoacLon.length >= 4) {
                    let answers = ngoacLon.slice(0, 4).map(pair => choices.substring(pair[0] + 1, pair[1]));
                    let correctAnswerIndex = answers.findIndex(answer => answer.includes('\\True'));
                    if (correctAnswerIndex !== -1) {
                        extractedData.type1.push(String.fromCharCode(65 + correctAnswerIndex)); // Convert index to A, B, C, D
                    } else {
                        extractedData.type1.push("N/A");
                    }
                } else {
                    extractedData.type1.push("N/A");
                }
            }

            // Process Type 2 Questions (\choiceTF)
            while ((matches = regexType2.exec(content)) !== null) {
                let choices = matches[1].trim();
                let ngoacLon = layCacNgoacLon(choices);
                if (ngoacLon.length >= 4) {
                    let answers = ngoacLon.slice(0, 4).map(pair => choices.substring(pair[0] + 1, pair[1]));
                    let result = answers.map(answer => answer.includes('\\True') ? 'Đ' : 'S').join('');
                    extractedData.type2.push(result);
                } else {
                    extractedData.type2.push("N/A");
                }
            }

            // Process Type 3 Questions (\shortans)
            while ((matches = regexType3.exec(content)) !== null) {
                let answer = matches[1].trim();
                let ngoacLon = layCacNgoacLon(answer);
                if (ngoacLon.length > 0) {
                    answer = answer.substring(ngoacLon[0][0] + 1, ngoacLon[0][1]).trim();
                }
                extractedData.type3.push(answer.replace(/\$|\{|\}/g, '').trim());
            }

            return extractedData;
        }

        function createHorizontalXlsx2(allExtractedData, currentMades) {
            const header = ["Đề \\ Câu"].concat(Array.from({ length: 40 }, (_, i) => (i + 1).toString()));

            const ws_data = [header];

            // Tạo hàng dữ liệu cho mỗi đề
            for (let k = 0; k < allExtractedData.length; k++) {
                const dataRow = [currentMades[k]];
                for (let i = 0; i < 40; i++) {
                    dataRow.push(allExtractedData[k].type1[i] || "");
                }

                // Thêm dữ liệu phần 2 (tách ra từng ký tự) từ cột AP (cột 41)
                const type2_start_col = 41;
                for (let i = 0; i < allExtractedData[k].type2.length; i++) {
                    const characters = allExtractedData[k].type2[i].split('');
                    for (let j = 0; j < characters.length; j++) {
                        const colIndex = type2_start_col + j + i * 4;
                        dataRow[colIndex] = characters[j];
                    }
                }

                // Thêm dữ liệu phần 3 (không tách) từ cột BV (cột 74)
                const type3_start_col = 73;
                for (let i = 0; i < allExtractedData[k].type3.length; i++) {
                    const colIndex = type3_start_col + i;
                    dataRow[colIndex] = allExtractedData[k].type3[i];
                }

                ws_data.push(dataRow);
            }

            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
            XLSX.writeFile(wb, "cham_thi.xlsx");
        }
   
        $('#downloadXlsxButtonTwo').on('click', function () {
                let content = collectContentFromTable();
                let numFiles = document.getElementById('numFiles') ? document.getElementById('numFiles').value : null;
                let hoanViType = document.getElementById('hoanViType') ? document.getElementById('hoanViType').value : 'ngoac';
                let headerType = document.getElementById('headerType') ? document.getElementById('headerType').value : 'default';
                let school = $('#school').val();
                let teacher = $('#teacher').val();
                let exam = $('#exam').val();
                let subject = $('#subject').val();
                let time = $('#time').val();
                let made = $('#made').val().split(',').map(item => item.trim());
                let phieuTo = document.getElementById('phieuTo') ? document.getElementById('phieuTo').value : 'phieu1';
                let dapAn = document.getElementById('dapAn') ? document.getElementById('dapAn').value : 'dap_an_1';

                if (content && numFiles) {
                    let { results, files, currentMades } = generateFiles(content, numFiles, hoanViType, headerType, school, teacher, exam, subject, time, made, phieuTo, dapAn);
                    displayResults(results);
                    let allExtractedData = files.map(fileContent => extractLatexData2(fileContent));
                    createHorizontalXlsx2(allExtractedData, currentMades);
                    alert('Hoán vị và ghi Excel mẫu 2 xong!');
                }
            });
       

          ///
            function parseFileGOC(content, school, teacher, exam, subject, time, made, numFiles, hoanViType, headerType, phieuTo, dapAn) {
                let sentences = content.match(/\\begin{ex}[\s\S]+?\\end{ex}/g);
                let tableBody = $('#latexTable tbody');
                tableBody.empty();
    
                if (!sentences) {
                    alert("Không tìm thấy câu hỏi nào trong tệp.");
                    return;
                }
    
                sentences.forEach((sentence, index) => {
                    let idPattern = /([6-9|0-2])([A-Z])([0-9])([YBKGTNHVC])([0-9])-([0-9])/g;
                    let ids = Array.from(sentence.matchAll(idPattern)).map(match => match[0]).join(', ');
                    let id_meaning = "ID Ý NGHĨA";  // Thay đổi tùy theo ý nghĩa của ID
    
                    let row = $('<tr></tr>');
                    row.append(`<td>${index + 1}</td>`);
                    row.append(`<td>${ids}</td>`);
                    row.append(`<td>${id_meaning}</td>`);
    
                    //let textArea = $('<textarea class="form-control"></textarea>');
                    // Thay đổi giá trị height để làm khung textarea lớn hơn
                    let textArea = $('<textarea class="form-control" style="height: 300px;"></textarea>');
                    textArea.val(sentence);
                    let cell = $('<td></td>');
                    cell.append(textArea);
                    row.append(cell);
    
                    let checkbox = $('<input type="checkbox">');
                    let checkboxCell = $('<td></td>');
                    checkboxCell.append(checkbox);
                    row.append(checkboxCell);
    
                    if (sentence.includes('choice') && !sentence.includes('choiceTF')) {
                        row.css('background-color', '#FFEB3B'); // Yellow for choice
                    } else if (sentence.includes('choiceTF')) {
                        row.css('background-color', '#8BC34A'); // Green for choiceTF
                    } else {
                        row.css('background-color', '#03A9F4'); // Blue for others
                    }
    
                    tableBody.append(row);
                });
    
                $('#resultSection').show();
            }
    // Function to parse file content and display in the table
    function parseFile(content, school, teacher, exam, subject, time, made, numFiles, hoanViType, headerType, phieuTo, dapAn) {
            let sentences = content.match(/\\begin{ex}[\s\S]+?\\end{ex}/g);
            let tableBody = $('#latexTable tbody');
            tableBody.empty();

            if (!sentences) {
                alert("Không tìm thấy câu hỏi nào trong tệp.");
                return;
            }

            sentences.forEach((sentence, index) => {
                let idPattern = /([6-9|0-2])([A-Z])([0-9])([YBKGTNHVC])([0-9])-([0-9])/g;
                let ids = Array.from(sentence.matchAll(idPattern)).map(match => match[0]).join(', ');
                let id_meaning = ids.split(', ').map(id => getIdMeaning(id)).join(', ');

                let row = $('<tr></tr>');
                row.append(`<td style="width: 5%;">${index + 1}</td>`);
                row.append(`<td style="width: 10%;">${ids}</td>`);
                row.append(`<td style="width: 15%;">${id_meaning}</td>`);

                let textArea = $('<textarea class="form-control" style="height: 200px;"></textarea>');
                textArea.val(sentence);
                let cell = $('<td style="width: 70%;"></td>');
                cell.append(textArea);
                row.append(cell);

                let checkbox = $('<input type="checkbox">');
                let checkboxCell = $('<td style="width: 5%;"></td>');
                checkboxCell.append(checkbox);
                row.append(checkboxCell);

                if (sentence.includes('choice') && !sentence.includes('choiceTF')) {
                    row.css('background-color', '#FFEB3B'); // Yellow for choice
                } else if (sentence.includes('choiceTF')) {
                    row.css('background-color', '#8BC34A'); // Green for choiceTF
                } else {
                    row.css('background-color', '#03A9F4'); // Blue for others
                }

                tableBody.append(row);
            });

            $('#resultSection').show();
        }

            function collectContentFromTable() {
                let tableBody = $('#latexTable tbody');
                let content = '';
    
                tableBody.find('tr').each(function () {
                    let textArea = $(this).find('textarea');
                    let sentence = textArea.val();
                    content += sentence + '\n';
                });
    
                return content;
            }
    
            function displayResults(results) {
                $('#results').empty();
                results.forEach(function (result, index) {
                    let resultHtml = `
                <h3>File ${index + 1}</h3>
                <textarea class="form-control mb-3" rows="10" readonly>${result.content}</textarea>
                <a href="${result.download_url}" class="btn btn-success mb-3" download="hoanvi_${index + 1}.tex">Tải về file đã hoán vị</a>
                <button class="btn btn-primary mb-3" onclick="copyToClipboard(\`${result.content.replace(/\\/g, '\\\\').replace(/'/g, "\\'").replace(/"/g, '\\"').replace(/\n/g, '\\n').replace(/\r/g, '\\r')}\`)">Copy nội dung</button>
            `;
                    $('#results').append(resultHtml);
                });
                $('#resultSection').show();
            }
    
            function copyToClipboard(text) {
                let tempTextarea = document.createElement('textarea');
                tempTextarea.value = text;
                document.body.appendChild(tempTextarea);
                tempTextarea.select();
                document.execCommand('copy');
                document.body.removeChild(tempTextarea);
                alert('Đã copy nội dung vào clipboard!');
            }
    
            function hoanViCacNgoacLon(noiDung) {
                let cacVitriNgoacLon = layCacNgoacLon(noiDung).slice(0, 4);
    
                if (cacVitriNgoacLon.length === 4) {
                    let cacNgoacLonGoc = cacVitriNgoacLon.map(([dau, cuoi]) => noiDung.slice(dau, cuoi + 1));
                    let cacNgoacLonHoanVi = [...cacNgoacLonGoc];
    
                    for (let i = cacNgoacLonHoanVi.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [cacNgoacLonHoanVi[i], cacNgoacLonHoanVi[j]] = [cacNgoacLonHoanVi[j], cacNgoacLonHoanVi[i]];
                    }
    
                    cacNgoacLonGoc.forEach((goc, index) => {
                        noiDung = noiDung.replace(goc, cacNgoacLonHoanVi[index]);
                    });
                }
    
                return noiDung;
            }
    
            function hoanViNgoacLonNgauNhien(text) {
                let sentences = text.match(/\\begin{ex}[\s\S]+?\\end{ex}/g);
    
                if (!sentences) {
                    return {
                        groupChoice: '',
                        groupchoiceTF: '',
                        groupNone: '',
                        countChoice: 0,
                        countchoiceTF: 0,
                        countNone: 0
                    };
                }
    
                let groupChoice = [];
                let groupchoiceTF = [];
                let groupNone = [];
    
                sentences.forEach(sentence => {
                    if (sentence.includes('choice') && !sentence.includes('choiceTF')) {
                        groupChoice.push(sentence);
                    } else if (sentence.includes('choiceTF')) {
                        groupchoiceTF.push(sentence);
                    } else {
                        groupNone.push(sentence);
                    }
                });
    
                function processGroup(group) {
                    return group.map(sentence => {
                        let indexChoice = sentence.search(/\\choice|\\choiceTF|\\choiceTFt|\\choiceTF\[t\]|\\choiceTF\[n\]/);
                        if (indexChoice !== -1) {
                            let noiDungTruocChoice = sentence.slice(0, indexChoice);
                            let noiDungSauChoice = sentence.slice(indexChoice);
                            noiDungSauChoice = hoanViCacNgoacLon(noiDungSauChoice);
    
                            return noiDungTruocChoice + noiDungSauChoice;
                        }
                        return sentence;
                    });
                }
    
                groupChoice = processGroup(groupChoice);
                groupchoiceTF = processGroup(groupchoiceTF);
                groupNone = groupNone.map(sentence => sentence);
    
                return {
                    groupChoice: groupChoice.join('\n'),
                    groupchoiceTF: groupchoiceTF.join('\n'),
                    groupNone: groupNone.join('\n'),
                    countChoice: groupChoice.length,
                    countchoiceTF: groupchoiceTF.length,
                    countNone: groupNone.length
                };
            }
    
            function hoanViCauTruc(text) {
                let sentences = text.match(/\\begin{ex}[\s\S]+?\\end{ex}/g);
    
                if (!sentences) {
                    return {
                        groupChoice: '',
                        groupchoiceTF: '',
                        groupNone: '',
                        countChoice: 0,
                        countchoiceTF: 0,
                        countNone: 0
                    };
                }
    
                sentences.sort(() => Math.random() - 0.5);
    
                let groupChoice = [];
                let groupchoiceTF = [];
                let groupNone = [];
    
                sentences.forEach(sentence => {
                    if (sentence.includes('choice') && !sentence.includes('choiceTF')) {
                        groupChoice.push(sentence);
                    } else if (sentence.includes('choiceTF')) {
                        groupchoiceTF.push(sentence);
                    } else {
                        groupNone.push(sentence);
                    }
                });
    
                function processGroup(group) {
                    return group.map(sentence => {
                        let indexChoice = sentence.search(/\\choice|\\motcot|\\haicot|\\choice\[2\]|\\choiceTF|\\choiceTFt|\\choiceTF\[t\]|\\choiceTF\[n\]/);
                        if (indexChoice !== -1) {
                            let noiDungTruocChoice = sentence.slice(0, indexChoice);
                            let noiDungSauChoice = sentence.slice(indexChoice);
                            noiDungSauChoice = hoanViCacNgoacLon(noiDungSauChoice);
    
                            return noiDungTruocChoice + noiDungSauChoice;
                        }
                        return sentence;
                    });
                }
    
                groupChoice = processGroup(groupChoice);
                groupchoiceTF = processGroup(groupchoiceTF);
                groupNone = processGroup(groupNone);
    
                return {
                    groupChoice: groupChoice.join('\n'),
                    groupchoiceTF: groupchoiceTF.join('\n'),
                    groupNone: groupNone.join('\n'),
                    countChoice: groupChoice.length,
                    countchoiceTF: groupchoiceTF.length,
                    countNone: groupNone.length
                };
            }
    
            function getHeaderContent(type, school, teacher, exam, subject, time,phieuto) {
                const headers = {
                    default: `\\documentclass[12pt,a4paper]{article}
\\usepackage{amsmath,amssymb,makecell,fancyhdr,enumerate,arcs,physics,tasks,mathrsfs,graphics}
\\usepackage{tikz,tikz-3dplot,tkz-euclide,tkz-tab,tabvar,pgfplots,esvect}
\\usepackage[top=1.5cm, bottom=1.5cm, left=2cm, right=1.5cm]{geometry}
\\usepackage[hidelinks,unicode]{hyperref}
\\usepackage[utf8]{vietnam}
\\usepackage[dethi]{ex_test}
\\usetikzlibrary{shapes.geometric,shadings,calc,snakes,patterns,arrows,intersections,angles,backgrounds,quotes}
\\usepgfplotslibrary{fillbetween}
\\pgfplotsset{compat=newest}
\\tikzset{point style/.append style={color=white}}
\\def\\vec{\\overrightarrow}
\\newcommand{\\hoac}[1]{\\left[\\begin{aligned}#1\\end{aligned}\\right.}
\\newcommand{\\heva}[1]{\\left\\{\\begin{aligned}#1\\end{aligned}\\right.}
\\newcommand{\\hetde}{\\centerline{\\rule[0.5ex]{2cm}{1pt} HẾT \\rule[0.5ex]{2cm}{1pt}}}
\\newcommand{\\tentruong}{${school}}
    \\newcommand{\\tengv}{${teacher}}
    \\newcommand{\\tenkythi}{${exam}}
    \\newcommand{\\tenmonthi}{${subject}}
    \\newcommand{\\thoigian}{${time}}
    \\newcommand{\\tieude}[3]{
	\\noindent
	%Trái
	\\begin{minipage}[b]{7cm}
		\\centerline{\\textbf{\\fontsize{13}{0}\\selectfont \\tentruong}}
		\\centerline{\\textbf{\\fontsize{13}{0}\\selectfont \\tengv}}
		\\centerline{(\\textit{Đề thi có #1\\ trang})}
		\\centerline{\\textit{ }}
	\\end{minipage}\\hspace{1.5cm}
	%Phải
	\\begin{minipage}[b]{9cm}
		\\centerline{\\textbf{\\fontsize{13}{0}\\selectfont \\tenkythi}}
		\\centerline{\\textbf{\\fontsize{13}{0}\\selectfont \\tenmonthi}}
		\\centerline{\\textit{\\fontsize{12}{0}\\selectfont Thời gian làm bài \\thoigian \\ phút }}
		\\centerline{\\textit{\\fontsize{12}{0}\\selectfont (Đề có AAsangAA câu trắc nghiệm, BBsangBB câu đúng sai, CCsangCC câu điền đáp án)}}
	\\end{minipage}
	\\begin{minipage}[b]{13cm}
		\\vspace*{.75cm}
		\\textbf{Họ và tên thí sinh: }{\\tiny\\dotfill}\\\\
		\\textbf{Số Báo Danh: }{\\tiny\\dotfill}
	\\end{minipage}
	\\begin{minipage}[b]{8cm}
		\\hspace*{1cm}\\fbox{\\bf Mã đề thi #3}
	\\end{minipage}
}
\\newcommand{\\chantrang}[2]{\\rfoot{Trang \\thepage/#1 $-$ Mã đề #2}}
\\pagestyle{fancy}
\\fancyhf{}
\\renewcommand{\\headrulewidth}{0pt}
\\def\\colorEX{}% màu phương án đúng
\\renewtheorem{ex}{\\color{blue!80!black}\\textbf{Câu}}
    `,
                    option1: `
    \\newcommand{\\tentruong}{${school}}
    \\newcommand{\\tengv}{${teacher}}
    \\newcommand{\\tenkythi}{${exam}}
    \\newcommand{\\tenmonthi}{${subject}}
    \\newcommand{\\thoigian}{${time}}
    \\newcommand{\\tieude}[2]{
    \\noindent
    `
                };
    
                return headers[type] || headers['default'];
            }
    
            function generateFiles(content, numFiles, hoanViType, headerType, school, teacher, exam, subject, time, made, phieuTo, dapAn) {
                let results = [];
                let headerContent = getHeaderContent(headerType, school, teacher, exam, subject, time,phieuTo);
                 
                const phieuToContent = `\\section*{Phiếu Tô ${phieuTo}}\n\\section*{Đáp án ${dapAn}}\n`;
                let files = [];
                let currentMades = []; // Mảng chứa các currentMade
    
                for (let i = 0; i < numFiles; i++) {
                    let resultContent;
                    let hoanViKetQua;
    
                    if (hoanViType === 'ngoac') {
                        hoanViKetQua = hoanViNgoacLonNgauNhien(content);
                    } else if (hoanViType === 'cau_truc') {
                        hoanViKetQua = hoanViCauTruc(content);
                    } else if (hoanViType === 'giu_nguyen') {
                        hoanViKetQua = {
                            groupChoice: content,
                            groupchoiceTF: '',
                            groupNone: '',
                            countChoice: 0,
                            countchoiceTF: 0,
                            countNone: 0
                        };
                    }
    
                    let currentMade = made[i % made.length];
                    currentMades.push(currentMade); // Lưu lại currentMade
    
                    resultContent = `
    ${headerContent}
    \\newcommand{\\made}{${currentMade}}
    \\begin{document}   
    \\tieude{\\pageref{\\made}}{0}{\\made}
    \\chantrang{\\pageref{\\made}}{\\made}
     ${getPhieuToContent(phieuTo)}
    \\subsection*{PHẦN I. Câu trắc nghiệm nhiều phương án lựa chọn. Thí sinh trả lời từ câu 1 đến câu ${hoanViKetQua.countChoice}. Mỗi câu hỏi thí sinh chỉ chọn một phương án.}
    \\setcounter{ex}{0}
    \\Opensolutionfile{ans}[ans/ans-phanI]
    ${hoanViKetQua.groupChoice}
    \\Closesolutionfile{ans}
    
    \\subsection*{PHẦN II. Câu trắc nghiệm đúng sai. Thí sinh trả lời từ câu 1 đến câu ${hoanViKetQua.countchoiceTF}. Trong mỗi ý a), b), c), d) ở mỗi câu, thí sinh chọn đúng hoặc sai.}
    \\setcounter{ex}{0}
    \\Opensolutionfile{ans}[ans/ans-phanII]
    ${hoanViKetQua.groupchoiceTF}
    \\Closesolutionfile{ans}
    
    \\subsection*{PHẦN III. Câu trắc nghiệm trả lời ngắn. Thí sinh trả lời từ câu 1 đến câu ${hoanViKetQua.countNone}.}
    \\setcounter{ex}{0}
    \\Opensolutionfile{ans}[ans/ans-phanIII]
    ${hoanViKetQua.groupNone}
    \\Closesolutionfile{ans}
    
    \\hetde\\label{\\made}
    \\newpage
    \\begin{center}
    \\textbf{\\large BẢNG ĐÁP ÁN}
    \\end{center}
    \\noindent\\textbf{A. ĐÁP ÁN PHẦN I}
    \\inputansbox{10}{ans/ans-phanI}
    \\noindent\\textbf{B. ĐÁP ÁN PHẦN II}
    \\inputansbox[2]{2}{ans/ans-phanII}
    \\noindent\\textbf{C. ĐÁP ÁN PHẦN III}
    \\inputansbox[3]{6}{ans/ans-phanIII}
    \\end{document}
    `;
                    // Thay thế các ký hiệu bằng giá trị thực tế
                    resultContent = resultContent.replace('AAsangAA', hoanViKetQua.countChoice);
                    resultContent = resultContent.replace('BBsangBB', hoanViKetQua.countchoiceTF);
                    resultContent = resultContent.replace('CCsangCC', hoanViKetQua.countNone);
    
                    results.push({
                        content: resultContent,
                        download_url: `data:text/plain;charset=utf-8,${encodeURIComponent(resultContent)}`
                    });
                    files.push(resultContent);
                }
    
                return { results, files, currentMades }; // Trả về thêm currentMades
            }
    
            function createHorizontalXlsx(allExtractedData, currentMades) {
                const mergedData = mergeExtractedDataForHorizontal(allExtractedData, currentMades);
                
                const ws = XLSX.utils.aoa_to_sheet(mergedData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
                XLSX.writeFile(wb, "extracted_data_horizontal.xlsx");
            }
    
            function mergeExtractedDataForHorizontal(allExtractedData, currentMades) {
                let headers = ['Đề \\ Câu', ...Array.from({ length: 40 }, (_, i) => (i + 1).toString())];
                for (let i = 1; i <= 8; i++) {
                    for (let j = 0; j < 4; j++) {
                        headers.push(`${i}${['a', 'b', 'c', 'd'][j]}`);
                    }
                }
                headers.push(...Array.from({ length: 6 }, (_, i) => (i + 1).toString()));
    
                let mergedData = [headers];
    
                allExtractedData.forEach((data, index) => {
                    let row = [currentMades[index]];
                    let part1 = data.slice(0, 40);
                    let part2 = data.slice(40, 72).flatMap(answer => answer.split(''));
                    let part3 = data.slice(72);
    
                    row.push(...part1, ...part2, ...part3);
                    mergedData.push(row);
                });
    
                return mergedData;
            }
        
        });
    </script>
    
 
</body>
</html>
